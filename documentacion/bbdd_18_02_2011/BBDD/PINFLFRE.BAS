10 '                       PINFLFRE.BAS
20 '                      --------------
30 '           LISTADOS DE LOS RECIBOS DE FACTURACION
40 '       ---------------------------------------------
52 '
54 '
56 '
60 ON ERROR GOTO 9100
70 '
80 KEY 1,CHR$(14):KEY 7,CHR$(7):KEY 8,CHR$(9):KEY 10,CHR$(10)
82 KEY 2,CHR$(15):KEY 3,CHR$(16):KEY 4,CHR$(17)
90 CERO$=STRING$(15,"0")
100 '
132 GOSUB 33000
133 FECHA$=MID$(DATE$,4,3)+LEFT$(DATE$,3)+RIGHT$(DATE$,2)
134 FEFACT$=RIGHT$(DATE$,2)+LEFT$(DATE$,2)
135 FEDIA$=RIGHT$(DATE$,2)+LEFT$(DATE$,2)+MID$(DATE$,4,2)
140 DEFSTR C,G,B,F
150 OPTION BASE 1
200 DIM TABENT$(30)
210 GOSUB 4490
220 GOTO 9000
230 '
240 '
3490 '**********************
3500 '***LINEA DE DETALLE***
3510 '**********************
3520 GUAPRI#=NUME%:N.D%=0:GOSUB 64770:LPRINT TAB(25-L.C%) GUAPRI$;
3522 LPRINT TAB(26) "-";
3532 GUAPRI#=VAL(FALUM):N.D%=0:GOSUB 64770:LPRINT TAB(31-L.C%) GUAPRI$;
3540 GUAPRI#=CVS(FIMPO):N.D%=2:GOSUB 64770:LPRINT TAB(107-L.C%) GUAPRI$
3550 LPRINT
3552 LPRINT TAB(42) RIGHT$(FFEEX,2)"-"MID$(FFEEX,3,2)"-"LEFT$(FFEEX,2);
3560 LPRINT TAB(87) RIGHT$(FFEEX,2)"-"MID$(FFEEX,3,2)"-"LEFT$(FFEEX,2)
3570 FOR A%=1 TO 7:LPRINT :NEXT A%
3571 LPRINT       'LPRINT TAB(2) "20-063-1.832-9"
3572 LPRINT TAB(21) FSUCU;
3580 LPRINT TAB(62) FOFIC " - " FDIGI;
3596 'IF RIGHT$(FBANC,4)="2095" THEN 3640
3630 LPRINT TAB(86) FCUEN:GOTO 3660
3640 '
3650 '
3660 LPRINT:LPRINT
3662 LPRINT TAB(21) FAOMB
3664 LPRINT
3666 LPRINT TAB(21) FDIRE
3670 TOTGOP#=TOTGOP#+1
3680 TOTGEF#=YOTGEF#+CVS(FIMPO)
3700 LPRINT CHR$(12)
3729 RETURN
4000 '************************************
4010 '***LECTURA FICHERO DE OPERACIONES***
4020 '************************************
4025 REG%=REG%+1
4027 IF REG%>ULTIMO% THEN FF$="FF":RETURN
4028 'IF REG%>3 THEN FF$="FF":RETURN
4030 GET #4,REG%
4032 NUME%=NUME%+1
4035 IF NUME%<DESDE% THEN 4025
4040 IF NUME%>HASTA% THEN FF$="FF":RETURN
4090 RETURN
4100 '
4480 '*************************
4490 '***INFORME DEL FICHERO***
4500 '*************************
4502 WIDTH "LPT1:",132:OPEN "LPT1:" FOR OUTPUT AS #9
4503 LPRINT CHR$(27) "C" CHR$(24);:LPRINT CHR$(15)
4504 '
4510 GOSUB 8000
4512 TIT$="- LISTADO DE RECIBOS DE FACTURACION -"
4514 X%=80-LEN(TIT$):X%=INT(X%/2)
4520 COLOR 10:LOCATE 6,X%:PRINT TIT$
4530 LOCATE 7,X%:PRINT STRING$(LEN(TIT$),205)
4532 GOSUB 35000   'APERTURA FICHERO DE FACTURACION
4534 FF$="":LIN%=90:PAG%=0:DESDE%=0:HASTA%=9999
4536 GOSUB 4000      'hacer lectura fichero de facturaci¢n
4538 IF FF$="FF" THEN GOSUB 8500:MEN$="No tenemos Fichero de Facturaci¢n, pulsar una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 9000
4539 CLOSE #4:REG%=0
4540 GOSUB 8500:MEN$="Coloca los Recibos en la Impresora y pulsa una tecla":GOSUB 8500:A$=INPUT$(1):GOSUB 8500
4542 LPRINT TAB(25) "11.111";
4544 LPRINT TAB(102) "9.999"
4546 LPRINT CHR$(12)
4548 MEN$="Comprobar que los recibos est n bien puestos y pulsar una tecla":GOSUB 8500:A$=INPUT$(1):GOSUB 8500
4552 LPRINT TAB(25) "11.111";
4554 LPRINT TAB(102) "9.999"
4556 LPRINT CHR$(12)
4558 MEN$="Vuelve a comprobar si est n bien puestos y pulsar una tecla":GOSUB 8500:A$=INPUT$(1):GOSUB 8500
4570 COLOR 11
4580 LOCATE 12,12:PRINT " DESDE EL NUMERO  : <    >   HASTA EL NUMERO  : <    >"
4581 LOCATE 14,24:PRINT "Para finalizar pulsar la tecla ";
4582 COLOR 15:PRINT "F7 "
4585 'LOCATE 18,16:COLOR 12:PRINT "EL BANCO 99999999 CORRESPONDE A PAGOS EN METALICO"
4590 COLOR 15
4792 'Pedimos fecha desde.
4794 F.C1%=12:C.C1%=33:L.E%=4:BO%=4:ESC%=1:GOSUB 63000
4796 IF I.T%=0 THEN LOCATE 12,33:PRINT D.E$:GOTO 4800
4797 IF I.T%=4 THEN 9000
4798 GOTO 4792
4800 '
4804 DESDE%=VAL(D.E$)
4806 'Pedimos fecha hasta.
4807 F.C1%=12:C.C1%=61:L.E%=4:BO%=4:ESC%=1:GOSUB 63000
4808 IF I.T%=0 THEN LOCATE 12,61:PRINT D.E$:GOTO 4811
4809 IF I.T%=4 THEN 9000
4810 GOTO 4806
4811 '
4812 HASTA%=VAL(D.E$)
4813 IF DESDE%>HASTA% THEN 4570
4814 GOSUB 8500
4815 COLOR 11:LOCATE 22,15:PRINT "Datos correctos, pulsar ";
4816 COLOR 15:PRINT " ENTER ";
4817 COLOR 11:PRINT " Err¢neos pulsar ";
4818 COLOR 15:PRINT " F1"
4819 A$=INPUT$(1)
4820 IF ASC(A$)<13 OR ASC(A$)>14 THEN BEEP:GOTO 4819
4821 IF ASC(A$)=14 THEN 4570
4822 '
4823 '
4824 '
4825 GOSUB 8500:MEN$="Espere por Favor...":GOSUB 8500
4826 GOSUB 35000
4828 TOTGGOP#=0    'TOTAL GENERAL DE RECIBOS
4829 TOTGGRE#=0    'TOTAL GENERAL DE IMPORTES
5050 FF$="":LIN%=90:PAG%=0:REG%=1:NUME%=0
5052 '
5060 GOSUB 4000      'hacer lectura fichero de facturaci¢n
5070 IF FF$="FF" THEN GOSUB 8500:MEN$="No tenemos los Datos Solicitados, pulsar una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 4570
5088  '
5090 WHILE FF$<>"FF"
5150 '
5220     GOSUB 3500      'HACER LINEA DE DETALLE
5230     GOSUB 4000      'LECTURA DE OPERACIONES.
5240 '
5540 WEND
5660  CLOSE:GOSUB 8500:GOTO 4570
5670  '
5700  '
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:COLOR 10:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 11:LOCATE 2,3:PRINT EMPRESA$ :COLOR 10:LOCATE 2,34:PRINT "Aplicaci¢n : ACADEMIAS ":COLOR 11:LOCATE 2,63:PRINT "FECHA : "FECHA$" ":COLOR 10 : LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8070 FOR J%=4 TO 21 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8090 LOCATE 22,1:PRINT CHR$(186):COLOR 11:LOCATE 22,3:PRINT "Mensajes: ":COLOR 10:LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 COLOR 7,0,0:RETURN
8120 '
8250 '
8490 '*************************
8500 '***IMPRESION DE MENSAJES*
8510 '*************************
8515 '
8520 COLOR 11:L.L$=""+MEN$+"":LOCATE 22,14:PRINT L.L$;
8525 IF RET%=1 THEN FOR H=1 TO 7500:NEXT H:RET%=0
8530 MEN$=SPACE$(64)
8540 RETURN
8550 '
9000 '**********************
9010 '***FIN DEL PROGRAMA***
9020 '**********************
9030 CLOSE
9040 RUN "PINFDISF"
9050 END
9060 '
9070 '
9080 '
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9130 IF ERR=24 OR ERR=25 OR ERR=27 THEN GOSUB 8500:MEN$="--COMPRUEBE LA IMPRESORA Y PULSE UNA TECLA---":GOSUB 8500:A$=INPUT$(1):RESUME
9140 GOTO 9150
9142 GOSUB 8500:MEN$="Fichero de ALUMNOS inexistente":RET%=1:GOSUB 8500:CLOSE:GOTO 9000
9144 GOSUB 8500:MEN$="Fichero de ALUMNOS inexistente":RET%=1:GOSUB 8500:CLOSE:GOTO 9000
9150 '
9170 ON ERROR GOTO 0
9180 '
33000 '**********************************
33010 '***APERTURA FICHERO DATOS FIJOS***
33020 '**********************************
33030 OPEN "R",#1,"FDATFIJ.DAT",100
33040 FIELD #1,2 AS NRO$,8 AS NDIRE$,30 AS NEMPRESA$,15 AS NNIF$,8 AS NPROG$,37 AS NFILLER$
33050 GET #1,1
33052 NROEM$=NRO$
33060 DIRE$=NDIRE$
33070 EMPRESA$="** ACADEMIA INFORMATICA **"
33080 NIF$=NNIF$
33082 PROGRAMA$=NPROG$
33090 CLOSE
33100 '
33110 '
33120 RETURN
33130 '
35000 '*************************************
35010 '***APERTURA FICHERO DE FACTURACION***
35020 '*************************************
35030 OPEN "R",#4,"FINFFACT.CLA",210
35040 FIELD #4,1 AS FSTATUS,2 AS FULTI,4 AS FFACT,12 AS FETIQ,191 AS FRES
35050 FIELD #4,1 AS FSTAT,5 AS FALUM,4 AS FIMPO,6 AS FFEEX,50 AS FAOMB,40 AS FDIRE,20 AS FPOBL,4 AS FBANC,30 AS FSUCU,10 AS FCUEN,4 AS FOFIC,2 AS FDIGI,34 AS FFIL
35060 GET #4,1
35070 IF FETIQ="FINFFACT.DAT" THEN 35090
35080 GOSUB 8500:MEN$="No tenemos fichero de Facturacion, pulsar una tecla":GOSUB 8500:A$=INPUT$(1):GOTO 9000
35090 ULTIMO%=CVI(FULTI)
35120 RETURN
35130 '
63000 '********************************
63010 '***RUTINA DE ENTRADA NUMERICA***
63020 '********************************
63030 '
63040 D.E$="":I.T%=0
63050 LOCATE F.C1%,C.C1%,1,0,6
63060 FOR JMG%=1 TO L.E%
63070  D.R$=INPUT$(1)
63075  IF ASC(D.R$)=14 AND JMG%=1 THEN JMG%=L.E%:I.T%=5:GOTO 63200  '===>AL NEXT
63080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 63200  '===>AL NEXT
63090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 63200  '===>AL NEXT
63100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 63200  '===>AL NEXT
63110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 63200   '===>AL NEXT
63120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 63200   '===>AL NEXT
63130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%,"-"):LOCATE F.C1%,C.C1%
63135 IF D.R$="," THEN D.R$=".":GOTO 63150
63140  IF D.R$<"0" OR D.R$>"9" THEN 63170               'Error
63150  D.E$=D.E$+D.R$:PRINT D.R$;
63160  GOTO 63200 'AL NEXT
63170  'Error.
63175  IF ASC(D.R$)=8 AND JMG%=1 THEN 63190
63180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT "-":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
63190  JMG%=JMG%-1
63200 NEXT JMG%
63210 IF I.T%<>0 THEN 63230
63220 IF LEN(D.E$)<>L.E% THEN D.E$=LEFT$(CERO$,L.E%-LEN(D.E$))+D.E$
63225 LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," ")
63230 RETURN
63240 '
64000 '*************************************
64010 '***RUTINA DE ENTRADA ALFA/NUMERICA***
64020 '*************************************
64030 '
64040 D.E$="":I.T%=0
64050 LOCATE F.C1%,C.C1%,1,0,6
64060 FOR JMG%=1 TO L.E%
64070  D.R$=INPUT$(1)
64075  IF ASC(D.R$)=14 AND JMG%=1 THEN JMG%=L.E%:I.T%=5:GOTO 64200  '===>AL NEXT
64080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 64200  '===>AL NEXT
64090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 64200  '===>AL NEXT
64100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 64200  '===>AL NEXT
64110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 64200   '===>AL NEXT
64120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 64200   '===>AL NEXT
64130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," "):LOCATE F.C1%,C.C1%
64135  IF ASC(D.R$)=34 THEN 64170
64140  IF ASC(D.R$)<32 OR ASC(D.R$)>126 THEN 64170               'Error
64150  D.E$=D.E$+D.R$:PRINT D.R$;
64160  GOTO 64200 'AL NEXT
64170  'Error.
64172  IF D.R$="¥" OR D.R$="¤" THEN 64150
64175  IF ASC(D.R$)=8 AND JMG%=1 THEN 64190
64180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
64190  JMG%=JMG%-1
64200 NEXT JMG%
64210 IF I.T%<>0 THEN 64230
64220 'D.E$=D.E$+LEFT$(BLANCO$,L.E%-LEN(D.E$))
64225 'LOCATE F.C1%,C.C1%:PRINT D.E$
64230 RETURN
64240 '
64760 '========================================================================
64762 ' RUTINA PARA EDITAR IMPORTES EN CRISTIANO X.XXX.XXX,XX                 =
64764 '                                                                       =
64766 ' SE ENTRARA A ESTA RUTINA DE LA FORMA  SIGUIENTE:                      =
64768 '                                                                       =
64770 ' GOSUB 64760 MANDANDO EN UN CAMPO LLAMADO GUAPRI#,                     =
64772 '                                                                       =
64773 '             LA CANTIDAD O NUMERO QUE DESEEMOS EDITAR.                 =
64774 '                                                                       =
64775 '             Y EN UN CAMPO LLAMADO N.D% EL NUMERO DE DECIMALES         =
64776 '                                                                       =
64778 ' DEVOLVERA EL CAMPO EDITADO EN GUAPRI$ Y LA LONGITUD EN L.C%           =
64780 '                                                                       =
64782 '========================================================================
64784 IF N.D%=2 THEN 64788
64786 N.D%=0
64788 GUAPRI$=STR$(GUAPRI#):L.P%=0
64790 FOR I%=1 TO 30:TABENT$(I%)="":NEXT I%
64792 SIGNO$=LEFT$(GUAPRI$,1):GUAPRI$=RIGHT$(GUAPRI$,LEN(GUAPRI$)-1)
64794 FOR I%=1 TO LEN(GUAPRI$)
64796   IF MID$(GUAPRI$,I%,1)="." THEN L.P%=I%:I%=LEN(GUAPRI$)
64798 NEXT I%
64800 IF L.P%=0 AND N.D%=2 THEN DEC$=",00":ENT$=GUAPRI$:GOTO 64812
64801 IF L.P%=0 THEN DEC$="":ENT$=GUAPRI$:GOTO 64812
64802 IF N.D%=0 THEN DEC$="":GOTO 64808
64804 DEC$=","+MID$(GUAPRI$,L.P%+1,N.D%)
64806 IF LEN(DEC$)<>N.D%+1 THEN DEC$=DEC$+LEFT$(CERO$,N.D%+1-LEN(DEC$))
64808 ENT$=LEFT$(GUAPRI$,L.P%-1)
64810 IF LEN(ENT$)=0 THEN GUAPRI$="0":GOTO 64834
64812 X%=31
64814 FOR I%=LEN(ENT$) TO 1 STEP -1
64816   X%=X%-1
64818   IF X%=27 OR X%=23 OR X%=19 OR X%=15 OR X%=12 THEN TABENT$(X%)=".":X%=X%-1
64820   TABENT$(X%)=MID$(ENT$,I%,1)
64822 NEXT I%
64824 GUAPRI$=""
64826 FOR I%=1 TO 30
64828   IF TABENT$(I%)="" THEN 64832
64830   GUAPRI$=GUAPRI$+TABENT$(I%)
64832 NEXT I%
64833 IF SIGNO$=" " THEN GUAPRI$=GUAPRI$+DEC$:L.C%=LEN(GUAPRI$)-1:GOTO 64835
64834 GUAPRI$=GUAPRI$+DEC$+SIGNO$:L.C%=LEN(GUAPRI$)-1
64835 N.D%=0
64836 RETURN
64838 '
