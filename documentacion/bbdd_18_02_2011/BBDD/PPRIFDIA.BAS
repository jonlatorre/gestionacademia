10 '                        PACAFDIA.BAS
20 '                    ---------------------
30 '        PROGRAMA DE CIERRE TOTAL DEL DIA EN ACADEMIAS
40 '        ---------------------------------------------
50 ON ERROR GOTO 9110
52 DEFSTR C,B,F
85 '
87 GOSUB 33000
90 OPTION BASE 1:KEY 1,CHR$(14)
100 '
102 '
111 '
140 GOSUB 8000
150 COLOR 11:LOCATE 10,24:PRINT "PROCESO DE FIN DE DIA EN ACADEMIAS"
160 LOCATE 11,24:PRINT STRING$(34,205)
165 GOSUB 8500:MEN$=" Espere por favor ........:GOSUB 8500
210 GOSUB 34000
302 IF ULTDIR%=ACTDIR% THEN CLOSE:GOTO 500  'CONTINUAR CON EL PROGRAMA.
304 '
306 FICBAT$="ACABANCO.BAT;"+DIRE$+";"+PROGRAMA$
308 '
310 CLS
312 SHELL FICBAT$
314 CLS
316 CLOSE
318 GOSUB 34010
320 GET #3,1
322 ULTIMO%=ALTDIR%+1
324 LSET BULTIMO=MKI$(ULTIMO%)
326 LSET BULTACT=MKI$(ULTIMO%)
328 PUT #3,1
329 SIRES$="1"
330 CLOSE
340 GOSUB 8000
350 COLOR 11:LOCATE 10,24:PRINT "PROCESO DE FIN DE DIA EN ACADEMIAS"
360 LOCATE 11,24:PRINT STRING$(34,205)
365 GOSUB 8500:MEN$=" Espere por favor ........:GOSUB 8500
500 '
6200 '
6210 'Miramos si debemos hacer el sort del dir
6215 FALUDIR$="FACAALUM.ALF":FALUDAT$="FACAALUM.DAT"
6220 'GOSUB 30000
6230 'IF ULTIMO%=ULTACT% THEN CLOSE:GOTO 7000
6240 '
6300 '************************
6310 '***HACER SORT DE DIR.***
6320 '************************
6322 'GET #2,1
6324 'LSET CULTACT=CULTI
6326 'PUT #2,1
6328 SIRES$="1"
6330 'CLOSE
6340 'CLS
6350 'SHELL "ACAALFA.BAT"
6370 '
6400 GOSUB 8000
6410 COLOR 11:LOCATE 10,24:PRINT "PROCESO DE FIN DE DIA EN ACADEMIAS"
6420 LOCATE 11,24:PRINT STRING$(34,205)
6430 GOSUB 8500:MEN$=" Espere por favor ........:GOSUB 8500
7000 '
7220 GOSUB 30000
7230 IF CSWA="0" THEN CLOSE:GOTO 7500
7240 '
7300 '************************
7310 '***HACER SORT DE DIR.***
7320 '************************
7322 GET #2,1
7324 LSET CSWA="0"
7326 PUT #2,1
7330 CLOSE
7340 CLS
7350 SHELL "ACAALFA.BAT"
7370 '
7400 GOSUB 8000
7410 COLOR 11:LOCATE 10,24:PRINT "PROCESO DE FIN DE DIA EN ACADEMIAS"
7420 LOCATE 11,24:PRINT STRING$(34,205)
7430 GOSUB 8500:MEN$=" Espere por favor ........:GOSUB 8500
7500 '
7510 IF SIRES$<>"1" THEN 7600
7512 COLOR 28:LOCATE 13,18:PRINT "ES CONVENIENTE SACAR RESPALDO DE LOS FICHEROS"
7514 COLOR 11:LOCATE 14,18:PRINT STRING$(45,205)
7516 GOSUB 8500:LOCATE 22,15
7518 COLOR 11:PRINT "Para sacar Respaldos pulsar ";
7520 COLOR 15:PRINT " ENTER ";
7522 COLOR 11:PRINT ", Si no pulsar ";
7524 COLOR 15:PRINT " F1 "
7526 A$=INPUT$(1)
7528 IF ASC(A$)<13 OR ASC(A$)>14 THEN BEEP:GOTO 7526
7530 IF ASC(A$)=14 THEN 7600
7540 '
7550 '
7560 '
7570 '
7580 CLS
7590 SHELL "ACABACK.BAT"
7600 GOSUB 60000:FOR H!=1 TO 8000!:B=B:NEXT H!
7610 '
7620 GOSUB 61000
7630 FOR H!=1 TO 8000!:B=B:NEXT H!:CLS
7640 GOTO 9000
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:COLOR 10:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 11:LOCATE 2,3:PRINT" " EMPRESA$" ":COLOR 10:LOCATE 2,34:PRINT "Aplicaci¢n : ACADEMIAS ":COLOR 11:LOCATE 2,63:PRINT "FECHA : "FECHA$" ":COLOR 10 : LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8070 FOR J%=4 TO 21 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8090 LOCATE 22,1:PRINT CHR$(186):COLOR 11:LOCATE 22,3:PRINT "Mensajes: ":COLOR 10:LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 COLOR 7,0,0:RETURN
8120 '
8250 '
8490 '*************************
8500 '***IMPRESION DE MENSAJES*
8510 '*************************
8515 '
8520 L.L$=""+MEN$+"":LOCATE 22,15:PRINT L.L$;
8525 IF RET%=1 THEN FOR H=1 TO 1500:NEXT H:RET%=0
8530 MEN$=SPACE$(64)
8540 RETURN
8550 '
9000 '**********************
9010 '***FIN DEL PROGRAMA***
9020 '**********************
9025 CLOSE
9030 SYSTEM              'FINALIZAR LA JORNADA
9040 '
9050 END
9060 '
9070 '
9080 '
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9130 '
9140 GOTO 9190
9142 GOSUB 8500:MEN$="Fichero FACAALUM.DIR inexistente, pulse una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 9000
9144 GOSUB 8500:MEN$="Fichero FACAALUM.DAT inexistente, pulse una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 9000
9150 '
9190 ON ERROR GOTO 0
30000 '*******************************
30010 '***APERTURA FICHERO ALUMNOS ***
30020 '*******************************
30025 '
30052 OPEN "R",#1,FALUDIR$,65
30054 FIELD #1,2 AS FULTI,20 AS FLLAMA,20 AS FAPE1,20 AS FAPE2,2 AS FILER,1 AS FSTA
30056 GET #1,1
30058 ULTIAL%=CVI(FULTI)
30090 ' Apertura del fichero de datos   FACAALUM.DAT
30100 OPEN "R",#2,FALUDAT$,270
30110 FIELD #2,5 AS CCUENTA,1 AS CSTATUS,20 AS CNOMBRE,20 AS CAPELL1,20 AS CAPELL2,40 AS CDIREC,20 AS CPOBLA,15 AS CPROVI,5 AS CCOPOS,7 AS CTELEFO,7 AS CTELEFA,13 AS CDNI,3 AS CGRUPO
30112 FIELD #2,176 AS TODO1$,6 AS CFENA,4 AS CBANCO,20 AS CSUCUR,17 AS CCUBAN,6 AS CFALTA,6 AS CFBAJA,1 AS CCUESP,4 AS CIMPOR,1 AS CMARCA,1 AS CCONFI,20 AS COBSER,4 AS CFACT,4 AS CFILL
30114 FIELD #2,5 AS CCUEN1,1 AS CSTAT,2 AS CULTI,2 AS CULTACT,12 AS CFICHER,1 AS CSWG,1 AS CSWA,237 AS REST1$,4 AS CFEFAC,5 AS REST2$
30115 GET #2,1
30116 IF CFICHER<>"FACAALUM.DAT" THEN 9144
30117 ULTIMO%=CVI(CULTI)
30118 ULTACT%=CVI(CULTACT):N.R%=ULTACT%
30120 '
30128 RETURN
30130 '
30140 '
33000 '**********************************
33010 '***APERTURA FICHERO DATOS FIJOS***
33020 '**********************************
33030 OPEN "R",#1,"FDATFIJ.DAT",100
33040 FIELD #1,2 AS NRO$,8 AS NDIRE$,30 AS NEMPRESA$,15 AS NNIF$,8 AS NPROG$,37 AS NFILLER$
33050 GET #1,1
33052 NROEM$=NRO$
33060 DIRE$=NDIRE$
33070 EMPRESA$=NEMPRESA$
33080 NIF$=NNIF$
33082 PROGRAMA$=NPROG$
33090 CLOSE
33100 '
33110 '
33120 RETURN
33130 '
34000 '*****************************
34010 '***APERTURA FICHERO BANCOS***
34020 '*****************************
34030 FICHE1$="\"+DIRE$+"\FACABANC.DAT"
34040 '
34050 'APERTURA FICHERO DE DATOS.
34060 OPEN "R",#3,FICHE1$,125
34070 'REGISTRO 1.
34080 FIELD #3,2 AS BULTIMO,2 AS BALTAS,2 AS BULTACT,12 AS BETIQUETA,106 AS BFILLER,1 AS BSTATUS
34090 'REGISTRO DE DATOS.
34100 FIELD #3,4 AS BANCO,30 AS BNOM,30 AS BDIREC,5 AS BCPOS,30 AS BPOBLA,20 AS BPROV,5 AS BFIL001,1 AS BSTATUS
34110 GET #3,1
34120 IF BETIQUETA="FACABANC.DAT" THEN 34160  'CONTINUAR
34130 GOSUB 8500:MEN$="NO EXISTE FICHERO BANCOS, PULSE UNA TECLA":GOSUB 8500
34140 A$=INPUT$(1)
34150 GOTO 9000
34160 'CONTINUAR.
34170 ULTDIR%=CVI(BULTIMO)    'ULTIMO INTRODUCIDO EN DIR.
34180 ULTBAN%=ULTDIR%         'ULTIMO PARA LA BUSQUEDA.
34190 ALTDIR%=CVI(BALTAS)     'NUMERO DE ALTAS EN DIR.
34200 ACTDIR%=CVI(BULTACT)    'ULTIMO NUMERO ACTUALIZADO EN DIR.
34210 N.B%=ACTDIR%            'NUMEO DE REGSITROS EN EL DIR.
34220 '
34230 RETURN
34240 '
34250 '*************************
34260 '***LECTURA AZAR BANCOS***
34270 '*************************
34280 'El argumento de busqueda sobre 'BUSCA$'
34290 'El numero de registros sobre 'N.B%'
34300 R.B%=0           'Donde devuelve el nro. de registro.
34310 R.W%=0           'Donde devuelve el nro. de registro del DIR.
34320 SW1%=0         'SW indicador de la busqueda.
34330 REG1%=0:REG2%=0:SW100%=0:DES%=0:HAS%=0
34340 '
34350 R.I%=INT((N.B%/2)+.5)
34360 R.C%=R.I%
34370 IF R.I%<1 THEN SW1%=1:DES%=2:HAS%=R.I%+R.C%:GOTO 34490
34380 IF R.I%>N.B% THEN SW1%=1:DES%=R.I%-R.C%:HAS%=N.B%:GOTO 34490
34390 IF R.I%=1 THEN R.I%=2:GET #3,R.I% ELSE GET #3,R.I%
34400 IF BANCO=BUSCA$ THEN R.W%=R.I%:R.B%=R.I%:GOTO 34660      'MIRAR STATUS
34410 R.C%=INT((R.C%/2)+.5):IF R.C%=R.I% THEN R.C%=R.I%-1
34420 IF BANCO>BUSCA$ THEN R.I%=R.I%-R.C%:GOTO 34440
34430 R.I%=R.I%+R.C%
34440 IF SW100%=0 AND REG1%=R.I% THEN R.I%=0:GOTO 34370
34450 IF SW100%=1 AND REG2%=R.I% THEN R.I%=0:GOTO 34370
34460 IF SW100%=0 THEN REG1%=R.I%:SW100%=1:GOTO 34370
34470 REG2%=R.I%:SW100%=0
34480 GOTO 34370
34490 'REGISTRO NO BUSCADO.
34500 XX%=0
34510 FOR A%=DES% TO HAS%
34520   GET #3,A%
34530   IF BANCO=BUSCA$ THEN SW1%=0:R.W%=A%:R.B%=A%:XX%=1:A%=HAS%
34540 NEXT A%
34550 IF XX%=1 THEN 34660
34560 '
34570 '
34580 'Registro NO BUSCADO
34590 XX%=0
34600 IF N.B%=0 THEN N.B%=1
34610 FOR JMG%=N.B% TO ULTBAN%
34620     GET #3,JMG%
34630     IF BANCO=BUSCA$ THEN SW1%=0:R.W%=JMG%:R.B%=JMG%:XX%=1:JMG%=32000
34640 NEXT JMG%
34650 IF XX%=0 THEN SW1%=1:WSTATUS$="":RETURN
34660 'MIRAMOS STATUS.
34670 IF BSTATUS<>"O" THEN WSTATUS$="L":SW1%=1:RETURN
34680 WSTATUS$=""
34690 RETURN
34700 '
60000 CLS:COLOR 15:LOCATE 2,1,0:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
60010  FOR J%=3 TO 22:LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80:PRINT CHR$(186);:NEXT
60020  LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
60030 '
60050 COLOR 12
60052 FOR A%=3 TO 22
60053 LOCATE A%,2:PRINT STRING$(78,"²")
60054 NEXT A%
60060 COLOR 10
60065 LOCATE 3,74:PRINT STRING$(6,"²")
60130 N%=8
60140 FOR A%=4 TO 21
60150 LOCATE A%,80-N%:PRINT STRING$(6,"²")
60160 N%=N%+4
60170 NEXT A%
60171 LOCATE 22,2:PRINT STRING$(6,"²")
60172 LOCATE 3,2:PRINT STRING$(6,"²")
60173 N%=4
60174 FOR A%=4 TO 21
60176 LOCATE A%,N%:PRINT STRING$(6,"²")
60178 N%=N%+4
60180 NEXT A%
60182 LOCATE 22,74:PRINT STRING$(6,"²")
60183 COLOR 15:LOCATE 12,2:PRINT STRING$(78,"²")
60184 LOCATE 13,2:PRINT STRING$(78,"²")
60186 FOR A%=3 TO 22
60187 LOCATE A%,38:PRINT STRING$(6,"²")
60188 NEXT A%
60190 'END
60200 COLOR 13:LOCATE 8,28,0:PRINT CHR$(201)+STRING$(23,205)+CHR$(187)
60210  FOR J%=9 TO 15:LOCATE J%,28:PRINT CHR$(186)+STRING$(23," ")+CHR$(186):NEXT
60220  LOCATE 16,28:PRINT CHR$(200)+STRING$(23,205)+CHR$(188);
60230 COLOR 15
60240 LOCATE 10,31:PRINT "A P L I C A C I O N"
60250 LOCATE 12,31:PRINT "  A C A D E M I A  "
60260 LOCATE 14,31:PRINT "    I N G L E S    "
60270 RETURN
61000 CLS
61010 LOCATE 10,31:PRINT "M U C H I S I M A S"
61020 LOCATE 12,31:PRINT "   G R A C I A S   "
61030 LOCATE 14,31:PRINT "H A S T A   O T R A"
61040 COLOR 9:LOCATE 8,28,0:PRINT CHR$(201)+STRING$(23,205)+CHR$(187)
61050  FOR J%=9 TO 15:LOCATE J%,28:PRINT CHR$(186):LOCATE J%,52:PRINT CHR$(186):NEXT
61060  LOCATE 16,28:PRINT CHR$(200)+STRING$(23,205)+CHR$(188);
61070 COLOR 15:N%=77
61080 LOCATE 23,2:PRINT STRING$(78,"²")
61090 FOR A%=22 TO 17 STEP -1
61100 LOCATE A%,80-N%:PRINT STRING$(N%,"²")
61110 N%=N%-4
61120 NEXT A%
61130 LOCATE 16,27:PRINT "²"
61140 FOR A%=16 TO 10 STEP -1
61150 LOCATE A%,53:PRINT STRING$(27,"²")
61160 NEXT A%
61170 N%=25:COLOR 12
61180 FOR A%=9 TO 3 STEP -1
61190 LOCATE A%,80-N%:PRINT STRING$(N%,"²")
61200 N%=N%-4
61210 NEXT A%
61220 COLOR 11
61230 N%=1
61240 FOR A%=22 TO 16 STEP -1
61250 LOCATE A%,2:PRINT STRING$(N%,"²")
61260 N%=N%+4
61270 NEXT A%
61280 FOR A%=15 TO 9 STEP -1
61290 LOCATE A%,2:PRINT STRING$(26,"²")
61300 NEXT A%
61310 LOCATE 9,53:PRINT STRING$(2,"²")
61320 LOCATE 8,2:PRINT STRING$(26,"²")
61330 LOCATE 8,53:PRINT STRING$(6,"²")
61340 N%=61
61350 FOR A%=7 TO 3 STEP -1
61360 LOCATE A%,2:PRINT STRING$(N%,"²")
61370 N%=N%+4
61380 NEXT A%
61390 LOCATE 2,2:PRINT STRING$(78,"²")
61391 COLOR 10
61392 FOR A%=4 TO 8
61393 LOCATE A%,6:PRINT STRING$(2,"²")
61394 NEXT A%
61395 LOCATE 5,4:PRINT STRING$(6,"²")
61400 COLOR 15:LOCATE 1,1,0:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
61410  FOR J%=2 TO 23:LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80:PRINT CHR$(186);:NEXT
61420  LOCATE 24,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
61430 RETURN
