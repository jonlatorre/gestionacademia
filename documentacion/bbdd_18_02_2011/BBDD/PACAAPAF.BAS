10 '                         PACAAPAF.BAS
20 '                       ---------------
30 '              CAMBIAR DE CURSO AUTOMATICO APTOS
40 '              ----------------------------------
50 ON ERROR GOTO 9100
60 '
70 CLS
80 GOSUB 33000    'COGER DATOS DE LA EMPRESA.
82 KEY 1,CHR$(14):KEY 7,CHR$(7):KEY 8,CHR$(9):KEY 10,CHR$(10)
84 KEY 2,CHR$(15):KEY 3,CHR$(16):KEY 4,CHR$(17)
86 CERO$=STRING$(15,"0"):GUION$=STRING$(15,"-")
88 ENTER$=CHR$(17)+CHR$(196)+CHR$(217)
90 FDIA$=RIGHT$(DATE$,2)+LEFT$(DATE$,2)+MID$(DATE$,4,2)
92 FECHA$=RIGHT$(FDIA$,2)+"-"+MID$(FDIA$,3,2)+"-"+LEFT$(FDIA$,2)
94 '
96 DEFSTR B
98 '
100 '
110 '
120 '
130 '
140 '
306 '**********************
307 '***LISTADO POR NRO.***
308 '**********************
309 'MIRAMOS SI ESTA EL FICHERO ACTUALIZADO.
310 GOSUB 30010   'APERTURA FICHERO DE PLAN CONTABLE.
311 CLOSE
312 IF ULTDIR%=ACTDIR% THEN 500   'CONTINUAR CON EL PROGRAMA.
313 '
314 FICBAT$="ACAESCUE.BAT;"+DIRE$+";"+PROGRAMA$
315 '
316 CLS
317 SHELL FICBAT$
318 CLS
319 CLOSE
320 GOSUB 30010
321 GET #1,1
324 LSET BULTACT=MKI$(ULTIMO%)
325 PUT #1,1
326 CLOSE
327 '
490 '*********************************
500 '***PRESENTAMOS EL MENU GENERAL***
510 '*********************************
520 TIT$="- CAMBIO DE CURSO AUTOMATICO A TODOS LOS ALUMNOS APTOS (FRANCES) -"
530 X%=80-LEN(TIT$):X%=INT(X%/2)
540 GOSUB 8000
550 LOCATE 8,X%:PRINT TIT$
560 LOCATE 9,X%:PRINT STRING$(LEN(TIT$),205)
670 TOT$="- SOLAMENTE DEBE HACERSE UNA VEZ AL A¥O -"
680 X%=80-LEN(TOT$):X%=INT(X%/2)
690 LOCATE 11,X%:PRINT TOT$
700 LOCATE 12,X%:PRINT STRING$(LEN(TOT$),205)
1100 '
1110 '
1112 GOSUB 30010   'APERTURA FICHERO DE PLAN CONTABLE.
1114 '
1116 '
1590 '*************************************
1600 '***PEDIMOS CONFORMIDAD A LOS DATOS***
1610 '*************************************
1620 GOSUB 8500:MEN$="SI ESTAS DE ACUERDO PULSA "+ENTER$+" ,SINO PULSA -F1-":GOSUB 8500
1630 A$=INPUT$(1)
1640 IF ASC(A$)<13 OR ASC(A$)>14 THEN 1630
1650 IF ASC(A$)=14 THEN 9000
1652 '
5620 '
5622 GOSUB 5896              'HACER LECTURA DE INDICES Y DATOS
5624 '
5626 IF FF$="FF" THEN GOSUB 8500:MEN$="NO HAY DATOS, PULSE UNA TECLA":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 9000
5628 '
5630 WHILE FF$<>"FF"
5632  IF BCUR1="1" AND (BJUN1="A" OR BSEP1="A") THEN LSET BCUR2="2":LSET BCUR1=" "
5634  IF BCUR2="2" AND (BJUN2="A" OR BSEP2="A") THEN LSET BCUR3="3":LSET BCUR2=" "
5636  IF BCUR3="3" AND (BJUN3="A" OR BSEP3="A") THEN LSET BCUR4="4":LSET BCUR3=" "
5638  IF BCUR4="4" AND (BJUN4="A" OR BSEP4="A") THEN LSET BCUR5="5":LSET BCUR4=" "
5639  IF BCUR5="5" AND (BJUN5="A" OR BSEP5="A") THEN LSET BCUR5=" "
5640  PUT #1,REG%
5816   GOSUB 5896              'HACER LECTURA DE INDICES Y DATOS
5818   '
5820  WEND
5822  GOTO 9000
5894 '********************************
5896 '***LECTURA DE INDICES Y DATOS***
5898 '********************************
5900 REG%=REG%+1
5901 TECLA$=INKEY$:IF TECLA$="" THEN 5903
5902 IF ASC(TECLA$)=27 THEN FF$="FF":RETURN
5903 IF REG%>ULTIMO% THEN FF$="FF":RETURN
5904 GET #1,REG%
5916 IF BSTATUS<>"O" THEN 5900
5918 IF BMARCA="B" THEN 5900
5919 RETURN
5920 'IF BCUR1=HASTA$ AND BJUN1<>"A" THEN RETURN
5922 'IF BCUR2=HASTA$ AND BJUN2<>"A" THEN RETURN
5924 'IF BCUR3=HASTA$ AND BJUN3<>"A" THEN RETURN
5926 'IF BCUR4=HASTA$ AND BJUN4<>"A" THEN RETURN
5928 'IF BCUR5=HASTA$ AND BJUN5<>"A" THEN RETURN
5942 'GOTO 5900
6000 '
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:COLOR 10:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 11:LOCATE 2,3:PRINT" " EMPRESA$" ":COLOR 10:LOCATE 2,34:PRINT "Aplicaci¢n : ACADEMIAS ":COLOR 11:LOCATE 2,63:PRINT "FECHA : "FECHA$" ":COLOR 10 : LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8070 FOR J%=4 TO 21 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8090 LOCATE 22,1:PRINT CHR$(186):COLOR 11:LOCATE 22,3:PRINT "Mensajes: ":COLOR 10:LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 COLOR 15:RETURN
8120 '
8250 '
8500 '***************************
8510 '***IMPRESION DE MENSAJES***
8520 '***************************
8530 L.L$=""+MEN$+"":LOCATE 22,15:PRINT L.L$;
8550 MEN$=SPACE$(65)
8560 RETURN
8570 '
9000 '*********************
9010 '***FIN DE PROGRAMA***
9020 '*********************
9030 CLOSE
9040 CLS
9050 RUN "PACAESFR"
9060 '
9070 '
9080 END
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9130 IF ERR=24 OR ERR=25 OR ERR=27 THEN GOSUB 8500:MEN$="COMPRUEBE LA IMPRESORA Y PULSE UNA TECLA":GOSUB 8500:A$=INPUT$(1):GOSUB 8500:RESUME
9140 '
9150 '
9160 '
9170 '
9180 '
9190 ON ERROR GOTO 0
9200 '
30000 '*****************************
30010 '***APERTURA FICHERO BANCOS***
30020 '*****************************
30022 FICHE1$="\"+DIRE$+"\FACAESFR.DAT"
30024 '
30030 'APERTURA FICHERO DE DATOS.
30040 OPEN "R",#1,FICHE1$,100
30042 'REGISTRO 1.
30050 FIELD #1,1 AS BSTATUS,12 AS BETIQUETA,2 AS BULTIMO,2 AS BULTACT,83 AS BFILLER
30052 'REGISTRO DE DATOS.
30054 FIELD #1,1 AS BSTATUS,6 AS BANCO,60 AS BNOM,1 AS BCUR1,1 AS BJUN1,1 AS BSEP1,1 AS BCUR2,1 AS BJUN2,1 AS BSEP2,1 AS BCUR3,1 AS BJUN3,1 AS BSEP3,1 AS BCUR4,1 AS BJUN4,1 AS BSEP4,1 AS BCUR5,1 AS BJUN5,1 AS BSEP5,18 AS BFIL001
30060 GET #1,1
30070 IF BETIQUETA="FACAESFR.DAT" THEN 30110  'CONTINUAR
30080 GOSUB 8500:MEN$="NO EXISTE FICHERO ESCUELA IDIOMAS, PULSE UNA TECLA":GOSUB 8500
30090 A$=INPUT$(1)
30100 GOTO 9000
30110 'CONTINUAR.
30120 ULTDIR%=CVI(BULTIMO)    'ULTIMO INTRODUCIDO EN DIR.
30122 ULTIMO%=ULTDIR%         'ULTIMO PARA LA BUSQUEDA.
30140 ACTDIR%=CVI(BULTACT)    'ULTIMO NUMERO ACTUALIZADO EN DIR.
30142 N.R%=ACTDIR%            'NUMEO DE REGSITROS EN EL DIR.
30150 '
30160 RETURN
30170 '
30400 '*************************
30410 '***LECTURA AZAR BANCOS***
30420 '*************************
30430 'El argumento de busqueda sobre 'BUSCA$'
30440 'El numero de registros sobre 'N.R%'
30450 R.B%=0           'Donde devuelve el nro. de registro.
30452 R.W%=0           'Donde devuelve el nro. de registro del DIR.
30460 SW1%=0         'SW indicador de la busqueda.
30470 REG1%=0:REG2%=0:SW100%=0:DES%=0:HAS%=0
30480 '
30490 R.I%=INT((N.R%/2)+.5)
30500 R.C%=R.I%
30510 IF R.I%<1 THEN SW1%=1:DES%=2:HAS%=R.I%+R.C%:GOTO 30630
30520 IF R.I%>N.R% THEN SW1%=1:DES%=R.I%-R.C%:HAS%=N.R%:GOTO 30630
30530 IF R.I%=1 THEN R.I%=2:GET #1,R.I% ELSE GET #1,R.I%
30540 IF BANCO=BUSCA$ THEN R.W%=R.I%:R.B%=R.I%:GOTO 30800      'MIRAR STATUS
30550 R.C%=INT((R.C%/2)+.5):IF R.C%=R.I% THEN R.C%=R.I%-1
30560 IF BANCO>BUSCA$ THEN R.I%=R.I%-R.C%:GOTO 30580
30570 R.I%=R.I%+R.C%
30580 IF SW100%=0 AND REG1%=R.I% THEN R.I%=0:GOTO 30510
30590 IF SW100%=1 AND REG2%=R.I% THEN R.I%=0:GOTO 30510
30600 IF SW100%=0 THEN REG1%=R.I%:SW100%=1:GOTO 30510
30610 REG2%=R.I%:SW100%=0
30620 GOTO 30510
30630 'REGISTRO NO BUSCADO.
30640 XX%=0
30650 FOR A%=DES% TO HAS%
30660   GET #1,A%
30670   IF BANCO=BUSCA$ THEN SW1%=0:R.W%=A%:R.B%=A%:XX%=1:A%=HAS%
30680 NEXT A%
30690 IF XX%=1 THEN 30800
30700 '
30710 '
30720 'Registro NO BUSCADO
30730 XX%=0
30740 IF N.R%=0 THEN N.R%=1
30750 FOR JMG%=N.R% TO ULTIMO%
30760     GET #1,JMG%
30770     IF BANCO=BUSCA$ THEN SW1%=0:R.W%=JMG%:R.B%=JMG%:XX%=1:JMG%=32000
30780 NEXT JMG%
30790 IF XX%=0 THEN SW1%=1:WSTATUS$="":RETURN
30800 'MIRAMOS STATUS.
30810 IF BSTATUS<>"O" THEN WSTATUS$="L":SW1%=1:RETURN
30820 WSTATUS$=""
30830 RETURN
30840 '
33000 '**********************************
33010 '***APERTURA FICHERO DATOS FIJOS***
33020 '**********************************
33030 OPEN "R",#1,"FDATFIJ.DAT",100
33040 FIELD #1,2 AS NRO$,8 AS NDIRE$,30 AS NEMPRESA$,15 AS NNIF$,8 AS NPROG$,37 AS NFILLER$
33050 GET #1,1
33052 NROEM$=NRO$
33060 DIRE$=NDIRE$
33070 EMPRESA$=NEMPRESA$
33080 NIF$=NNIF$
33082 PROGRAMA$=NPROG$
33090 CLOSE
33100 '
33110 '
33120 RETURN
33130 '
