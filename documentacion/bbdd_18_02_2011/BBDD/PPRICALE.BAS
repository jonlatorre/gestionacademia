10 '                       PACACALE.BAS
20 '                      --------------
30 '  GESTION FICHERO DEL HIBRIDO CALENDARIO BIZKAIA-ESPA¥A
40 '  -----------------------------------------------------
52 '
54 '
56 '
60 ON ERROR GOTO 9100
70 WIDTH "LPT1:",132:OPEN "LPT1:" FOR OUTPUT AS #9
75 LPRINT CHR$(27) "C" CHR$(72);:LPRINT CHR$(15)
80 KEY 1,CHR$(14):KEY 7,CHR$(7):KEY 8,CHR$(9):KEY 10,CHR$(10)
82 KEY 2,CHR$(15):KEY 3,CHR$(16):KEY 4,CHR$(17)
90 CERO$=STRING$(15,"0"):T$=STRING$(4,205):B$="    ":F$=STRING$(4,178)
100 '
132 FECHA$=MID$(DATE$,4,3)+LEFT$(DATE$,3)+RIGHT$(DATE$,2)
134 GOSUB 33000
140 DEFSTR H,C
150 OPTION BASE 1
160 DIM TABRUT$(5),DIAS$(31),DIAS%(12)
162 DIM TA01$(42),TA02$(42),TA03$(42),TA04$(42),TA05$(42),TA06$(42)
164 DIM TA07$(42),TA08$(42),TA09$(42),TA10$(42),TA11$(42),TA12$(42)
170 DATA 01,02,03,04,05,06,07,08,09,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31
172 FOR A%=1 TO 31:READ DIAS$(A%):NEXT A%
174 DATA 31,28,31,30,31,30,31,31,30,31,30,31
176 FOR A%=1 TO 12:READ DIAS%(A%):NEXT A%
178 '
200 DATA "      MODIFICACION  FESTIVOS      "
202 DATA "        CONSULTA DE UN DIA        "
210 DATA "   LISTADO DE UN A¥O DE VIZCAYA   "
220 DATA "   LISTADO DE UN A¥O DE MADRID    "
230 DATA "          FIN DE PROGRAMA         "
232 FOR I%=1 TO 5
234    READ TABRUT$(I%)
236 NEXT I%
299 '
300 '******************************
302 '***TRATAMIENTO DEL PROGRAMA***
310 '******************************
320 'Presentamos el Menu del Programa.
330 GOSUB 8000
332 TIT$="- GESTION DEL CALENDARIO ESCOLAR BIZKAIA-MADRID -"
334 X%=80-LEN(TIT$):X%=INT(X%/2)
340 COLOR 11:LOCATE 7,X%:PRINT TIT$
350 LOCATE 8,X%:PRINT STRING$(LEN(TIT$),205)
360 FOR I%=11 TO 15
370    LOCATE I%,24:PRINT TABRUT$(I%-10)
380 NEXT I%
390 '
400 GOSUB 8500:COLOR 11
410 LOCATE 22,15:PRINT "Seleccione Opci¢n con las Flechas y Pulsando la Tecla ";
420 COLOR 15:PRINT " ENTER "
430 'COLOR 7,0,0
440 '
450 C.F%=11:C%=24:L.F%=15:N.L%=5
460 GOSUB 50000
470 '
480 ON I.A% GOTO 510,510,4490,4490,9000
490 '
500 '
510 '
520 '
522 GOSUB 8500:MEN$="Espere Por Favor...":GOSUB 8500
530 GOSUB 30010        'Apertura Fichero HIBRIDO
550 '
570 '
590 '
610 MARGEN$="I"
618 GOSUB 8000:GOSUB 31000
619 C%=5:D%=15:T%=26
620 FOR F%=9 TO 20
630 IF I.A%=1 THEN GOSUB 7500:GOTO 1100
640 GOSUB 7650
1100       '*******************************
1105       '***ENTRADA FECHA A TRATAR   ***
1110       '*******************************
1115       COLOR 15
1120       F.C1%=F%:C.C1%=C%:L.E%=6:BO%=8:ESC%=0:GOSUB 63000
1125       IF I.T%=0 THEN FEV$=D.E$:SM%=1:GOTO 1170 'Entrada OK
1135       IF I.T%=1 THEN FEV$=MID$(HDIA,5,2)+MID$(HDIA,3,2)+MID$(HDIA,1,2):GOTO 1170
1145       IF I.T%=3 THEN 1120               'Retroceder Campo.
1150       IF I.T%=4 THEN 4000               'Fin Entrada.
1155       IF I.T%=2 THEN 1120
1165       '
1170       FECSUB$=FEV$:GOSUB 40000
1175       IF ERF%<>1 THEN 1195
1180       BEEP:GOSUB 8500:MEN$=" FECHA A TRATAR ERRONEA ":RET%=1:GOSUB 8500
1185       GOTO 1120
1195       LOCATE F%,C%:PRINT FDMA$:BUSCA$=FAMD$
1200       GOSUB 30160
1210       IF SWBUSCA%=0 THEN 1230
1220       GOSUB 8500:MEN$=" - ESTA FECHA NO EXISTE - ":RET%=1:GOSUB 8500:GOSUB 7500:GOTO 1120
1230       LOCATE F%,D%:PRINT HDES
1240       IF HSTAT="F" THEN ST$="FES":GOTO 1251
1250       ST$="HAB"
1251       IF HSBIL="F" THEN SB$="FES":GOTO 1260
1252       SB$="HAB"
1260       LOCATE F%,T%:PRINT ST$ " " SB$
1270       IF I.A%=2 THEN 2500
1900       '*******************************
1905       '***ENTRADA DESCUENTO O NO   ***
1910       '*******************************
1915       '
1920       F.C1%=F%:C.C1%=T%:L.E%=1:BO%=1:GOSUB 64000
1925       IF I.T%=0 THEN DES$=D.E$:LSET HSTAT=DES$:GOTO 1970 'Entrada OK
1935       IF I.T%=1  THEN DES$=HSTAT:GOTO 1970
1945       IF I.T%=3 THEN 1100               'Retroceder Campo.
1955       IF I.T%=4 THEN 4000               'Fin Entrada.
1965       IF I.T%=2 THEN LSET HSTAT=DES$
1970       IF DES$ = "H" THEN DES$="HAB":GOTO 1980
1972       IF DES$ = "F" THEN DES$="FES":GOTO 1980
1980       LOCATE F%,T%:PRINT DES$
1990       F.C1%=F%:C.C1%=T%+4:L.E%=1:BO%=1:GOSUB 64000
1991       IF I.T%=0 THEN DEB$=D.E$:LSET HSBIL=DEB$:GOTO 1996 'Entrada OK
1992       IF I.T%=1  THEN DEB$=HSBIL:GOTO 1996
1993       IF I.T%=3 THEN 1920               'Retroceder Campo.
1994       IF I.T%=4 THEN 4000               'Fin Entrada.
1995       IF I.T%=2 THEN LSET HSBIL=DEB$
1996       IF DEB$ = "H" THEN DEB$="HAB":GOTO 1998
1997       IF DEB$ = "F" THEN DEB$="FES":GOTO 1998
1998       LOCATE F%,T%+4:PRINT DEB$
2000   '*************************************
2002   '***PEDIMOS CONFORMIDAD A LOS DATOS***
2004   '*************************************
2006   GOSUB 8500
2008   LOCATE 22,15:PRINT "Datos Correctos ";
2010   COLOR 0,7,0:PRINT " ENTER ";
2012   COLOR 7,0,0:PRINT " Datos Erroneos ";
2014   COLOR 0,7,0:PRINT " F1 "
2016   COLOR 7,0,0
2018   '
2020   A$=INPUT$(1)
2022   IF ASC(A$)<13 OR ASC(A$)>14 THEN BEEP:GOTO 2020
2024   '
2026   IF ASC(A$)=13 THEN 2043
2027   LOCATE F%,C%:PRINT SPC(30):F%=F%-1:GOTO 2052
2030   '
2042   '
2043   PUT #2,N.L%
2050   '
2052   NEXT F%
2053   '
2054   IF MARGEN$="D" THEN 2064
2056   C%=47:D%=57:T%=68:MARGEN$="D":GOTO 620
2058   '
2060   '
2064   FOR F%=9 TO 20:LOCATE F%,2:PRINT SPC(78):NEXT F%
2065   MARGEN$="I"
2066   GOTO 619
2500 '
3230 '*****************************
3240 '***TRATAMIENTO DE CONSULTA***
3250 '*****************************
3260 GOSUB 8500:MEN$="   PULSE UNA TECLA PARA NUEVA CONSULTA   ":GOSUB 8500
3270 A$=INPUT$(1)
3280 GOTO 2052
3290 '
3300 '
4000 '**************************
4010 '***FIN ENTRADA DE DATOS***
4020 '**************************
4030 CLS
4040 CLOSE   'Cierre de los Ficheros.
4050 GOTO 302      'Volvemos al Menu.
4060 '
4130 IF VAL(HASTA$) MOD 4=0 THEN DIAS%(2)=29 ELSE DIAS%(2)=28
4480 '*************************
4490 '***INFORME DEL FICHERO***
4492 '*************************
4494 GOSUB 8500:MEN$="Espere por Favor...":GOSUB 8500
4496 GOSUB 30052
4500 '
4501 '
4502 '
4504 '
4510 GOSUB 8000
4511 FOR A%=1 TO 42
4512 TA01$(A%)="00H":TA02$(A%)="00H":TA03$(A%)="00H":TA04$(A%)="00H":TA05$(A%)="00H":TA06$(A%)="00H"
4514 TA07$(A%)="00H":TA08$(A%)="00H":TA09$(A%)="00H":TA10$(A%)="00H":TA11$(A%)="00H":TA12$(A%)="00H"
4515 NEXT A%
4520 COLOR 11:LOCATE 7,26:PRINT "- LISTADO DE UN CURSO ESCOLAR -"
4530 LOCATE 8,26:PRINT STRING$(31,205)
4540 COLOR 15:LOCATE 11,31:PRINT "Introduzca Datos :"
4550 COLOR 11:LOCATE 13,26:PRINT "CURSO DESEADO ... :  <     >"
4560 COLOR 12:LOCATE 15,25:PRINT " F10 ";
4570 COLOR 11:PRINT " Volver al Menu Anterior"
4580 COLOR 15
4590 'Pedimos numero de Orden DESDE.
4600 F.C1%=13:C.C1%=48:L.E%=4:BO%=5:ESC%=0:GOSUB 63000
4610 IF I.T%=0 THEN LOCATE 13,48:PRINT LEFT$(D.E$,2)"-"RIGHT$(D.E$,2):GOTO 4640
4620 IF I.T%=2 THEN CLOSE:GOTO 302     'Presentamos el Menu.
4630 GOTO 4600
4640 DESDE$=LEFT$(D.E$,2)
4645 HASTA$=RIGHT$(D.E$,2)
4650 IF VAL(DESDE$)+1<>VAL(HASTA$) THEN BEEP:LOCATE 13,48:PRINT SPC(5):GOTO 4600
4655 IF VAL(DESDE$)<88 OR VAL(DESDE$)>98 THEN BEEP:LOCATE 13,48:PRINT SPC(5):GOTO 4600
4810 PAG%=0:LIN%=90
4812 COLOR 11:GOSUB 8500:MEN$="Datos Correctos pulsar -ENTER-, erroneos -F1-":GOSUB 8500
4814 A$=INPUT$(1)
4816 IF ASC(A$)=14 THEN 4550
4818 GOSUB 8500:MEN$="Espere por Favor...":GOSUB 8500
4820 'Hacemos el Bucle de tratamiento.
4830 IF VAL(DESDE$) MOD 4=0 THEN DIAS%(2)=29 ELSE DIAS%(2)=28
4840 BUSCA$=DESDE$+"0901"
4842 GOSUB 30160
4844 IF SWBUSCA%=0 THEN 4848
4846 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
4848   NUMERO%=N.L%
4850   IF LEFT$(HDES,2)="LU" THEN N%=1
4852   IF LEFT$(HDES,2)="MA" THEN N%=2
4854   IF LEFT$(HDES,2)="MI" THEN N%=3
4855   IF LEFT$(HDES,2)="JU" THEN N%=4
4856   IF LEFT$(HDES,2)="JU" THEN N%=4
4858   IF LEFT$(HDES,2)="VI" THEN N%=5
4860   IF LEFT$(HDES,2)="SA" THEN N%=6
4862   IF LEFT$(HDES,2)="DO" THEN N%=7
4864   '
4866   FOR X%=N% TO N%+DIAS%(9)-1
4868   GET #2,NUMERO%
4869   IF I.A%=3 THEN TA01$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 4872
4870   TA01$(X%)=RIGHT$(HDIA,2)+HSTAT
4872   NUMERO%=NUMERO%+1
4874   NEXT X%
4876   '
4940 BUSCA$=DESDE$+"1001"
4942 GOSUB 30160
4944 IF SWBUSCA%=0 THEN 4948
4946 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
4948   NUMERO%=N.L%
4950   IF LEFT$(HDES,2)="LU" THEN N%=1
4952   IF LEFT$(HDES,2)="MA" THEN N%=2
4954   IF LEFT$(HDES,2)="MI" THEN N%=3
4955   IF LEFT$(HDES,2)="JU" THEN N%=4
4956   IF LEFT$(HDES,2)="JU" THEN N%=4
4958   IF LEFT$(HDES,2)="VI" THEN N%=5
4960   IF LEFT$(HDES,2)="SA" THEN N%=6
4962   IF LEFT$(HDES,2)="DO" THEN N%=7
4964   '
4966   FOR X%=N% TO N%+DIAS%(10)-1
4968   GET #2,NUMERO%
4969   IF I.A%=3 THEN TA02$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 4972
4970   TA02$(X%)=RIGHT$(HDIA,2)+HSTAT
4972   NUMERO%=NUMERO%+1
4974   NEXT X%
4976   '
5040 BUSCA$=DESDE$+"1101"
5042 GOSUB 30160
5044 IF SWBUSCA%=0 THEN 5048
5046 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5048   NUMERO%=N.L%
5050   IF LEFT$(HDES,2)="LU" THEN N%=1
5052   IF LEFT$(HDES,2)="MA" THEN N%=2
5054   IF LEFT$(HDES,2)="MI" THEN N%=3
5055   IF LEFT$(HDES,2)="JU" THEN N%=4
5056   IF LEFT$(HDES,2)="JU" THEN N%=4
5058   IF LEFT$(HDES,2)="VI" THEN N%=5
5060   IF LEFT$(HDES,2)="SA" THEN N%=6
5062   IF LEFT$(HDES,2)="DO" THEN N%=7
5064   '
5066   FOR X%=N% TO N%+DIAS%(11)-1
5068   GET #2,NUMERO%
5069   IF I.A%=3 THEN TA03$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5072
5070   TA03$(X%)=RIGHT$(HDIA,2)+HSTAT
5072   NUMERO%=NUMERO%+1
5074   NEXT X%
5076   '
5140 BUSCA$=DESDE$+"1201"
5142 GOSUB 30160
5144 IF SWBUSCA%=0 THEN 5148
5146 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5148   NUMERO%=N.L%
5150   IF LEFT$(HDES,2)="LU" THEN N%=1
5152   IF LEFT$(HDES,2)="MA" THEN N%=2
5154   IF LEFT$(HDES,2)="MI" THEN N%=3
5155   IF LEFT$(HDES,2)="JU" THEN N%=4
5156   IF LEFT$(HDES,2)="JU" THEN N%=4
5158   IF LEFT$(HDES,2)="VI" THEN N%=5
5160   IF LEFT$(HDES,2)="SA" THEN N%=6
5162   IF LEFT$(HDES,2)="DO" THEN N%=7
5164   '
5166   FOR X%=N% TO N%+DIAS%(12)-1
5168   GET #2,NUMERO%
5169   IF I.A%=3 THEN TA04$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5172
5170   TA04$(X%)=RIGHT$(HDIA,2)+HSTAT
5172   NUMERO%=NUMERO%+1
5174   NEXT X%
5176   '
5240 BUSCA$=HASTA$+"0101"
5242 GOSUB 30160
5243 IF VAL(DESDE$) MOD 4=0 THEN DIAS%(2)=29 ELSE DIAS%(2)=28
5244 IF SWBUSCA%=0 THEN 5248
5246 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5248   NUMERO%=N.L%
5250   IF LEFT$(HDES,2)="LU" THEN N%=1
5252   IF LEFT$(HDES,2)="MA" THEN N%=2
5254   IF LEFT$(HDES,2)="MI" THEN N%=3
5255   IF LEFT$(HDES,2)="JU" THEN N%=4
5256   IF LEFT$(HDES,2)="JU" THEN N%=4
5258   IF LEFT$(HDES,2)="VI" THEN N%=5
5260   IF LEFT$(HDES,2)="SA" THEN N%=6
5262   IF LEFT$(HDES,2)="DO" THEN N%=7
5264   '
5266   FOR X%=N% TO N%+DIAS%(1)-1
5268   GET #2,NUMERO%
5269   IF I.A%=3 THEN TA05$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5272
5270   TA05$(X%)=RIGHT$(HDIA,2)+HSTAT
5272   NUMERO%=NUMERO%+1
5274   NEXT X%
5276   '
5340 BUSCA$=HASTA$+"0201"
5342 GOSUB 30160
5344 IF SWBUSCA%=0 THEN 5348
5346 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5348   NUMERO%=N.L%
5350   IF LEFT$(HDES,2)="LU" THEN N%=1
5352   IF LEFT$(HDES,2)="MA" THEN N%=2
5354   IF LEFT$(HDES,2)="MI" THEN N%=3
5355   IF LEFT$(HDES,2)="JU" THEN N%=4
5356   IF LEFT$(HDES,2)="JU" THEN N%=4
5358   IF LEFT$(HDES,2)="VI" THEN N%=5
5360   IF LEFT$(HDES,2)="SA" THEN N%=6
5362   IF LEFT$(HDES,2)="DO" THEN N%=7
5364   '
5366   FOR X%=N% TO N%+DIAS%(2)-1
5368   GET #2,NUMERO%
5369   IF I.A%=3 THEN TA06$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5372
5370   TA06$(X%)=RIGHT$(HDIA,2)+HSTAT
5372   NUMERO%=NUMERO%+1
5374   NEXT X%
5376   '
5440 BUSCA$=HASTA$+"0301"
5442 GOSUB 30160
5444 IF SWBUSCA%=0 THEN 5448
5446 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5448   NUMERO%=N.L%
5450   IF LEFT$(HDES,2)="LU" THEN N%=1
5452   IF LEFT$(HDES,2)="MA" THEN N%=2
5454   IF LEFT$(HDES,2)="MI" THEN N%=3
5455   IF LEFT$(HDES,2)="JU" THEN N%=4
5456   IF LEFT$(HDES,2)="JU" THEN N%=4
5458   IF LEFT$(HDES,2)="VI" THEN N%=5
5460   IF LEFT$(HDES,2)="SA" THEN N%=6
5462   IF LEFT$(HDES,2)="DO" THEN N%=7
5464   '
5466   FOR X%=N% TO N%+DIAS%(3)-1
5468   GET #2,NUMERO%
5469   IF I.A%=3 THEN TA07$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5472
5470   TA07$(X%)=RIGHT$(HDIA,2)+HSTAT
5472   NUMERO%=NUMERO%+1
5474   NEXT X%
5476   '
5540 BUSCA$=HASTA$+"0401"
5542 GOSUB 30160
5544 IF SWBUSCA%=0 THEN 5548
5546 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5548   NUMERO%=N.L%
5550   IF LEFT$(HDES,2)="LU" THEN N%=1
5552   IF LEFT$(HDES,2)="MA" THEN N%=2
5554   IF LEFT$(HDES,2)="MI" THEN N%=3
5555   IF LEFT$(HDES,2)="JU" THEN N%=4
5556   IF LEFT$(HDES,2)="JU" THEN N%=4
5558   IF LEFT$(HDES,2)="VI" THEN N%=5
5560   IF LEFT$(HDES,2)="SA" THEN N%=6
5562   IF LEFT$(HDES,2)="DO" THEN N%=7
5564   '
5566   FOR X%=N% TO N%+DIAS%(4)-1
5568   GET #2,NUMERO%
5569   IF I.A%=3 THEN TA08$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5572
5570   TA08$(X%)=RIGHT$(HDIA,2)+HSTAT
5572   NUMERO%=NUMERO%+1
5574   NEXT X%
5576   '
5640 BUSCA$=HASTA$+"0501"
5642 GOSUB 30160
5644 IF SWBUSCA%=0 THEN 5648
5646 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5648   NUMERO%=N.L%
5650   IF LEFT$(HDES,2)="LU" THEN N%=1
5652   IF LEFT$(HDES,2)="MA" THEN N%=2
5654   IF LEFT$(HDES,2)="MI" THEN N%=3
5655   IF LEFT$(HDES,2)="JU" THEN N%=4
5656   IF LEFT$(HDES,2)="JU" THEN N%=4
5658   IF LEFT$(HDES,2)="VI" THEN N%=5
5660   IF LEFT$(HDES,2)="SA" THEN N%=6
5662   IF LEFT$(HDES,2)="DO" THEN N%=7
5664   '
5666   FOR X%=N% TO N%+DIAS%(5)-1
5668   GET #2,NUMERO%
5669   IF I.A%=3 THEN TA09$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5672
5670   TA09$(X%)=RIGHT$(HDIA,2)+HSTAT
5672   NUMERO%=NUMERO%+1
5674   NEXT X%
5676   '
5740 BUSCA$=HASTA$+"0601"
5742 GOSUB 30160
5744 IF SWBUSCA%=0 THEN 5748
5746 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5748   NUMERO%=N.L%
5750   IF LEFT$(HDES,2)="LU" THEN N%=1
5752   IF LEFT$(HDES,2)="MA" THEN N%=2
5754   IF LEFT$(HDES,2)="MI" THEN N%=3
5755   IF LEFT$(HDES,2)="JU" THEN N%=4
5756   IF LEFT$(HDES,2)="JU" THEN N%=4
5758   IF LEFT$(HDES,2)="VI" THEN N%=5
5760   IF LEFT$(HDES,2)="SA" THEN N%=6
5762   IF LEFT$(HDES,2)="DO" THEN N%=7
5764   '
5766   FOR X%=N% TO N%+DIAS%(6)-1
5768   GET #2,NUMERO%
5769   IF I.A%=3 THEN TA10$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5772
5770   TA10$(X%)=RIGHT$(HDIA,2)+HSTAT
5772   NUMERO%=NUMERO%+1
5774   NEXT X%
5776   '
5840 BUSCA$=HASTA$+"0701"
5842 GOSUB 30160
5844 IF SWBUSCA%=0 THEN 5848
5846 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5848   NUMERO%=N.L%
5850   IF LEFT$(HDES,2)="LU" THEN N%=1
5852   IF LEFT$(HDES,2)="MA" THEN N%=2
5854   IF LEFT$(HDES,2)="MI" THEN N%=3
5855   IF LEFT$(HDES,2)="JU" THEN N%=4
5856   IF LEFT$(HDES,2)="JU" THEN N%=4
5858   IF LEFT$(HDES,2)="VI" THEN N%=5
5860   IF LEFT$(HDES,2)="SA" THEN N%=6
5862   IF LEFT$(HDES,2)="DO" THEN N%=7
5864   '
5866   FOR X%=N% TO N%+DIAS%(7)-1
5868   GET #2,NUMERO%
5869   IF I.A%=3 THEN TA11$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5872
5870   TA11$(X%)=RIGHT$(HDIA,2)+HSTAT
5872   NUMERO%=NUMERO%+1
5874   NEXT X%
5876   '
5940 BUSCA$=HASTA$+"0801"
5942 GOSUB 30160
5944 IF SWBUSCA%=0 THEN 5948
5946 GOSUB 8500:MEN$="- EL A¥O PEDIDO NO ESTA EN EL FICHERO -":GOSUB 8500:GOTO 4510
5948   NUMERO%=N.L%
5950   IF LEFT$(HDES,2)="LU" THEN N%=1
5952   IF LEFT$(HDES,2)="MA" THEN N%=2
5954   IF LEFT$(HDES,2)="MI" THEN N%=3
5955   IF LEFT$(HDES,2)="JU" THEN N%=4
5956   IF LEFT$(HDES,2)="JU" THEN N%=4
5958   IF LEFT$(HDES,2)="VI" THEN N%=5
5960   IF LEFT$(HDES,2)="SA" THEN N%=6
5962   IF LEFT$(HDES,2)="DO" THEN N%=7
5964   '
5966   FOR X%=N% TO N%+DIAS%(8)-1
5968   GET #2,NUMERO%
5969   IF I.A%=3 THEN TA12$(X%)=RIGHT$(HDIA,2)+HSBIL:GOTO 5972
5970   TA12$(X%)=RIGHT$(HDIA,2)+HSTAT
5972   NUMERO%=NUMERO%+1
5974   NEXT X%
5976   '
6000 LPRINT TAB(47) "CURSO  ESCOLAR  " DESDE$ "-"HASTA$ "  EN  ";
6002 IF I.A%=3 THEN LPRINT TAB(74) "VIZCAYA":GOTO 6010
6004 LPRINT TAB(74) "MADRID."
6010 LPRINT TAB(47) STRING$(34,205)
6020 LPRINT TAB(16) "SEPTIEMBRE - " DESDE$;
6030 LPRINT TAB(59) "OCTUBRE - " DESDE$;
6040 LPRINT TAB(100) "NOVIEMBRE - " DESDE$
6326 GOSUB 16300
6328 DE%=1:HA%=7
6330 GOSUB 10000
6332 DE%=8:HA%=14
6334 GOSUB 10000
6336 DE%=15:HA%=21
6338 GOSUB 10000
6340 DE%=22:HA%=28
6342 GOSUB 10000
6344 DE%=29:HA%=35
6346 GOSUB 10000
6347 DE%=36:HA%=42:GOSUB 10000
6348 LPRINT TAB(5) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6350 LPRINT TAB(47) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6352 LPRINT TAB(89) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188)
6354 FOR A%=1 TO 42
6356 TA01$(A%)=TA04$(A%):TA02$(A%)=TA05$(A%):TA03$(A%)=TA06$(A%)
6358 NEXT A%
6359 '
6360 LPRINT TAB(16) "DICIEMBRE - " DESDE$;
6362 LPRINT TAB(60) "ENERO - " HASTA$;
6364 LPRINT TAB(101) "FEBRERO - " HASTA$
6371 '
6372 GOSUB 16300
6374 DE%=1:HA%=7
6376 GOSUB 10000
6378 DE%=8:HA%=14
6380 GOSUB 10000
6382 DE%=15:HA%=21
6384 GOSUB 10000
6386 DE%=22:HA%=28
6388 GOSUB 10000
6390 DE%=29:HA%=35
6392 GOSUB 10000
6394 DE%=36:HA%=42:GOSUB 10000
6396 LPRINT TAB(5) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6398 LPRINT TAB(47) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6400 LPRINT TAB(89) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188)
6402 FOR A%=1 TO 42
6404 TA01$(A%)=TA07$(A%):TA02$(A%)=TA08$(A%):TA03$(A%)=TA09$(A%)
6406 NEXT A%
6408 '
6410 LPRINT TAB(18) "MARZO - " HASTA$;
6412 LPRINT TAB(60) "ABRIL - " HASTA$;
6414 LPRINT TAB(102) "MAYO - " HASTA$
6421 '
6422 GOSUB 16300
6424 DE%=1:HA%=7
6426 GOSUB 10000
6428 DE%=8:HA%=14
6430 GOSUB 10000
6432 DE%=15:HA%=21
6434 GOSUB 10000
6436 DE%=22:HA%=28
6438 GOSUB 10000
6440 DE%=29:HA%=35
6442 GOSUB 10000
6444 DE%=36:HA%=42:GOSUB 10000
6446 LPRINT TAB(5) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6448 LPRINT TAB(47) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6450 LPRINT TAB(89) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188)
6452 FOR A%=1 TO 42
6454 TA01$(A%)=TA10$(A%):TA02$(A%)=TA11$(A%):TA03$(A%)=TA12$(A%)
6456 NEXT A%
6458 '
6460 LPRINT TAB(18) "JUNIO -" HASTA$;
6462 LPRINT TAB(60) "JULIO - " HASTA$;
6464 LPRINT TAB(101) "AGOSTO - "HASTA$
6471 '
6472 GOSUB 16300
6474 DE%=1:HA%=7
6476 GOSUB 10000
6478 DE%=8:HA%=14
6480 GOSUB 10000
6482 DE%=15:HA%=21
6484 GOSUB 10000
6486 DE%=22:HA%=28
6488 GOSUB 10000
6490 DE%=29:HA%=35
6492 GOSUB 10000
6494 DE%=36:HA%=42:GOSUB 10000
6496 LPRINT TAB(5) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6498 LPRINT TAB(47) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188);
6500 LPRINT TAB(89) CHR$(200) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(202) T$ CHR$(188)
6504 LPRINT CHR$(12):GOTO 4500
6506 GOTO 4510
7500 '***********************************************************
7510 '***PRESENTAMOS MENSAJES TECLAS DE FUNCION MODIFICACIONES***
7520 '***********************************************************
7530 GOSUB 8500:LOCATE 22,15
7540 COLOR 15:PRINT " ENTER =>";
7550 COLOR 11:PRINT " Salto  ";
7560 COLOR 15:PRINT " F7 =>";
7570 COLOR 11:PRINT " Fin  ";
7580 COLOR 15:PRINT " F8 =>";
7590 COLOR 11:PRINT " M.Izda. "
7600 COLOR 15
7610 '
7620 '
7630 RETURN
7640 '**************************************************
7650 '***PRESENTAMOS MENSAJES TECLAS DE FUNCION ALTAS***
7660 '**************************************************
7670 GOSUB 8500:LOCATE 22,15
7680 '
7690 '
7700 COLOR 15:PRINT " F7 =>";
7710 COLOR 11:PRINT " Fin de Consultas."
7720 'COLOR 0,7,0:PRINT " F8 =>";
7730 'COLOR 7,0,0:PRINT " M.Izda. ";
7740 'COLOR 0,7,0:PRINT " F10 =>";
7750 'COLOR 7,0,0:PRINT " Dup. "
7760 COLOR 15
7770 RETURN
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:COLOR 10:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 11:LOCATE 2,3:PRINT" " EMPRESA$" ":COLOR 10:LOCATE 2,34:PRINT "Aplicaci¢n : ACADEMIAS ":COLOR 11:LOCATE 2,63:PRINT "FECHA : "FECHA$" ":COLOR 10 : LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8070 FOR J%=4 TO 21 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8090 LOCATE 22,1:PRINT CHR$(186):COLOR 11:LOCATE 22,3:PRINT "Mensajes: ":COLOR 10:LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 COLOR 7,0,0:RETURN
8120 '
8250 '
8490 '*************************
8500 '***IMPRESION DE MENSAJES*
8510 '*************************
8515 '
8520 L.L$=""+MEN$+"":LOCATE 22,14:PRINT L.L$;
8525 IF RET%=1 THEN FOR H%=1 TO 1500:NEXT H%:RET%=0
8530 MEN$=SPACE$(64)
8540 RETURN
8550 '
9000 '**********************
9010 '***FIN DEL PROGRAMA***
9020 '**********************
9030 CLOSE
9040 RUN "PACAINIC"
9050 END
9060 '
9070 '
9080 '
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9130 IF ERR=24 OR ERR=25 OR ERR=27 THEN GOSUB 8500:MEN$="--COMPRUEBE LA IMPRESORA Y PULSE UNA TECLA---":GOSUB 8500:A$=INPUT$(1):RESUME
9140 IF ERL=30052 AND ERR=53 THEN GOSUB 8500:MEN$="Fichero FACTCALE.DIR inexistente, pulsa una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:RESUME 9000
9150 IF ERL=30100 AND ERR=53 THEN GOSUB 8500:MEN$="Fichero FACTCALE.DAT inexistente, pulsa una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:RESUME 9000
9170 ON ERROR GOTO 0
9180 '
10000 LPRINT TAB(5) CHR$(204) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(185);
10010 LPRINT TAB(47) CHR$(204) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(185);
10020 LPRINT TAB(89) CHR$(204) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(206) T$ CHR$(185)
10025 GOTO 10270
10030 C%=5
10040 FOR A%=DE% TO HA%
10050 LPRINT TAB(C%) CHR$(186);
10060 IF RIGHT$(TA01$(A%),1)="F" THEN LPRINT F$;:GOTO 10080
10070 LPRINT B$;
10080 C%=C%+5
10090 NEXT A%
10100 LPRINT CHR$(186);
10110 C%=47
10120 FOR A%=DE% TO HA%
10130 LPRINT TAB(C%) CHR$(186);
10140 IF RIGHT$(TA02$(A%),1)="F" THEN LPRINT F$;:GOTO 10160
10150 LPRINT B$;
10160 C%=C%+5
10170 NEXT A%
10180 LPRINT CHR$(186);
10190 C%=89
10200 FOR A%=DE% TO HA%
10210 LPRINT TAB(C%) CHR$(186);
10220 IF RIGHT$(TA03$(A%),1)="F" THEN LPRINT F$;:GOTO 10240
10230 LPRINT B$;
10240 C%=C%+5
10250 NEXT A%
10260 LPRINT CHR$(186);
10270 C%=5
10280 FOR A%=DE% TO HA%
10290 LPRINT TAB(C%) CHR$(186);
10300 IF LEFT$(TA01$(A%),2)="00" THEN LPRINT "    ";:GOTO 10330
10310 IF RIGHT$(TA01$(A%),1)="F" THEN LPRINT USING"²##²";VAL(LEFT$(TA01$(A%),2));:GOTO 10330
10320 LPRINT USING" ## ";VAL(LEFT$(TA01$(A%),2));
10330 C%=C%+5
10340 NEXT A%
10350 LPRINT CHR$(186);
10360 C%=47
10370 FOR A%=DE% TO HA%
10380 LPRINT TAB(C%) CHR$(186);
10390 IF LEFT$(TA02$(A%),2)="00" THEN LPRINT "    ";:GOTO 10420
10400 IF RIGHT$(TA02$(A%),1)="F" THEN LPRINT USING"²##²";VAL(LEFT$(TA02$(A%),2));:GOTO 10420
10410 LPRINT USING" ## ";VAL(LEFT$(TA02$(A%),2));
10420 C%=C%+5
10430 NEXT A%
10440 LPRINT CHR$(186);
10450 C%=89
10460 FOR A%=DE% TO HA%
10470 LPRINT TAB(C%) CHR$(186);
10480 IF LEFT$(TA03$(A%),2)="00" THEN LPRINT "    ";:GOTO 10510
10490 IF RIGHT$(TA03$(A%),1)="F" THEN LPRINT USING"²##²";VAL(LEFT$(TA03$(A%),2));:GOTO 10510
10500 LPRINT USING" ## ";VAL(LEFT$(TA03$(A%),2));
10510 C%=C%+5
10520 NEXT A%
10530 LPRINT CHR$(186);
10840 RETURN
16300 'LPRINT TAB(5) CHR$(201)+T$+CHR$(203)+T$+CHR$(203)+T$+CHR$(203)+T$+CHR$(203)+T$+CHR$(203)+T$+CHR$(203)+T$+CHR$(187);
16301 LPRINT TAB(5) CHR$(201) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(187);
16302 LPRINT TAB(47) CHR$(201) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(187);
16304 LPRINT TAB(89) CHR$(201) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(203) T$ CHR$(187)
16306 'LPRINT TAB(5) CHR$(186) " AS " CHR$(186) " AS " CHR$(186) " AS " CHR$(186) " OS " CHR$(186) " OS " CHR$(186) " LA " CHR$(186) " IG " CHR$(186);
16308 'LPRINT TAB(47) CHR$(186) " AS " CHR$(186) " AS " CHR$(186) " AS " CHR$(186) " OS " CHR$(186) " OS " CHR$(186) " LA " CHR$(186) " IG " CHR$(186);
16310 'LPRINT TAB(89) CHR$(186) " AS " CHR$(186) " AS " CHR$(186) " AS " CHR$(186) " OS " CHR$(186) " OS " CHR$(186) " LA " CHR$(186) " IG " CHR$(186)
16312 LPRINT TAB(5) CHR$(186) " LU " CHR$(186) " MA " CHR$(186) " MI " CHR$(186) " JU " CHR$(186) " VI " CHR$(186) " SA " CHR$(186) " DO " CHR$(186);
16314 LPRINT TAB(47) CHR$(186) " LU " CHR$(186) " MA " CHR$(186) " MI " CHR$(186) " JU " CHR$(186) " VI " CHR$(186) " SA " CHR$(186) " DO " CHR$(186);
16316 LPRINT TAB(89) CHR$(186) " LU " CHR$(186) " MA " CHR$(186) " MI " CHR$(186) " JU " CHR$(186) " VI " CHR$(186) " SA " CHR$(186) " DO " CHR$(186)
16324 RETURN
30000 '*******************************
30010 '***APERTURA FICHERO HIBRIDO ***
30020 '*******************************
30025 'Comprobamos la existencia del fichero.
30040 '
30050 '
30052 OPEN "R",#1,"FACACALE.DIR",12
30054 FIELD #1,6 AS HDIADIR,2 AS HNORDEN,1 AS HSTATUS,3 AS HRESTO
30055 FIELD #1,2 AS HULTIMO,10 AS HRESTO1
30056 GET #1,1
30058 ULTDIR%=CVI(HULTIMO):N.R%=ULTDIR%
30090 ' Apertura del fichero de datos   FACTCALE.DAT
30100 OPEN "R",#2,"FACACALE.DAT",20
30110 FIELD #2,6 AS HDIA,9 AS HDES,1 AS HSTAT,1 AS HSBIL,3 AS HFIL
30114 FIELD #2,2 AS HULTI,2 AS HULTACT,16 AS RESTO$
30115 GET #2,1
30116 ULTIMO%=CVI(HULTI)
30118 ULTACT%=ULTIMO%
30120 '
30128 RETURN
30130 '
30140 '
30150 '*************************
30160 '*************************
30170 '***BUSQUEDA DICOTOMICA***
30180 '*************************
30190 'El argumento de busqueda sobre 'BUSCA$'
30200 'El numero de registros sobre 'N.R%'
30210 'El REGISTRO ENCONTRADO SOBRE  N.L%
30220 N.L%=0:DES%=0:HAS%=0
30230 SWBUSCA%=0         'SW indicador de la busqueda.
30240 REG1%=0:REG2%=0:SW100%=0:DES%=0:HAS%=0
30250 '
30260 R.I%=INT((N.R%/2)+.5)
30270 R.C%=R.I%
30280 IF R.I%<1 THEN SWBUSCA%=1:DES%=2:HAS%=R.I%+R.C%:GOTO 30400
30290 IF R.I%>N.R% THEN SWBUSCA%=1:DES%=R.I%-R.C%:HAS%=N.R%:GOTO 30400
30300 IF R.I%=1 THEN R.I%=2:GET #1,R.I% ELSE GET #1,R.I%
30310 IF HDIADIR=BUSCA$ THEN N.L%=CVI(HNORDEN):GET #2,N.L%:RETURN     'Registro Buscado.
30320 R.C%=INT((R.C%/2)+.5):IF R.C%=R.I% THEN R.C%=R.I%-1
30330 IF HDIADIR>BUSCA$ THEN R.I%=R.I%-R.C%:GOTO 30350
30340 R.I%=R.I%+R.C%
30350 IF SW100%=0 AND REG1%=R.I% THEN R.I%=0:GOTO 30280
30360 IF SW100%=1 AND REG2%=R.I% THEN R.I%=0:GOTO 30280
30370 IF SW100%=0 THEN REG1%=R.I%:SW100%=1:GOTO 30280
30380 REG2%=R.I%:SW100%=0
30390 GOTO 30280
30400 'BUSQUEDA DE LOS ULTIMOS METIDOS.
30410 'BUSQUEDA DE LOS ULTIMOS METIDOS.
30420 SWBUSCA%=1
30430 FOR A% = DES% TO HAS%
30440 GET #1,A%
30450 IF HDIADIR=BUSCA$ THEN SWBUSCA%=0:N.L%=CVI(HNORDEN):GET #2,N.L%:RETURN     'Registro Buscado.
30460 NEXT A%
30470 FOR N.L%=ULTACT%+1 TO ULTIMO%
30480    GET #2,N.L%
30490    IF BUSCA$=HDIA THEN SWBUSCA%=0:WN.L%=N.L%:N.L%=ULTIMO%:GOTO 30500
30500 NEXT N.L%
30510 N.L%=WN.L%
30520 RETURN
30530 '
31000 '**********************************************
31010 '***PRESENTAMOS PANTALLA DE ENTRADA DE DATOS***
31020 '**********************************************
31030 COLOR 11
31040 LOCATE 5,24:PRINT TABRUT$(I.A%)
31042 LOCATE 6,24:PRINT STRING$(34,205)
31050 LOCATE 7,5:PRINT " D I A    DESCRIPC.  MAD-VIZ"
31052 LOCATE 7,47:PRINT " D I A    DESCRIPC.  MAD-VIZ"
31054 LOCATE 8,5:PRINT "--------  ---------  --- ---"
31056 LOCATE 8,47:PRINT "--------  ---------  --- ---"
31084 RETURN
33000 '**********************************
33010 '***APERTURA FICHERO DATOS FIJOS***
33020 '**********************************
33030 OPEN "R",#1,"FDATFIJ.DAT",100
33040 FIELD #1,2 AS NRO$,8 AS NDIRE$,30 AS NEMPRESA$,15 AS NNIF$,8 AS NPROG$,37 AS NFILLER$
33050 GET #1,1
33052 NROEM$=NRO$
33060 DIRE$=NDIRE$
33070 EMPRESA$=NEMPRESA$
33080 NIF$=NNIF$
33082 PROGRAMA$=NPROG$
33090 CLOSE
33100 '
33110 '
33120 RETURN
33130 '
40000 '
40010 '   +-------------------------------------------+
40020 '   +   SUBRUTINA de CONTROL DE FECHA LOGICA    +
40030 '   +-------------------------------------------+
40040 '   -  Recibe la fecha en formato DDMMAA sobre FECSUB$
40050 '   -  Devuelve sobre FEF$ la fecha en formato DD-MM-AA
40060 '   -  Utiliza ERF como Codigo de Retorno.0=fecha correcta,1=fecha erronea
40070 '-------------------------------------------------------------------------
40080 AA$=RIGHT$(FECSUB$,2):MM$=MID$(FECSUB$,3,2):DD$=LEFT$(FECSUB$,2)
40090 ANOMAX%=VAL(RIGHT$(DATE$,2))
40100 ANO%=VAL(AA$):MES%=VAL(MM$):DIA%=VAL(DD$):ERF%=0
40110 IF  (ANO% < 1  OR ANO% > 99 OR MES% < 1 OR MES% > 12) THEN 40150
40120 IF (ANO% MOD 4)= 0 THEN DIAS%(2)=29 ELSE DIAS%(2)=28
40130 IF (DIA% < 1 OR DIA% > DIAS%(MES%)) THEN 40150
40140 FDMA$=DD$+"-"+MM$+"-"+AA$:FAMD$=AA$+MM$+DD$:ERF%=0:RETURN 'Fecha Correcta
40150 ERF%=1:RETURN  'Fecha Incorrecta
40160 '-------------------------------------------------------------------------
40170 '
45010 'RINT CHR$(27)+"&l0O"+CHR$(27)+"(s10h3B";
50000 '************************
50010 '***RUTINA VIDEO INVERSO*
50020 '************************
50030 '
50035            ' Devuelve la opcion sobre I.A%
50050 R$=CHR$(0):F%=C.F%
50060 WHILE ASC(R$)<>13
50065 F.I%=C.F%-1
50070 FOR I.A%=1 TO N.L%
50080 F.I%=F.I%+1:IF F%=F.I% THEN 50100
50090 NEXT I.A%
50100 'Tengo el valor de I.A%
50110 COLOR 12:LOCATE F%,C%:PRINT TABRUT$(I.A%)
50120 R$=INKEY$:IF R$="" THEN 50120
50121 IF ASC(R$)=13 OR ASC(R$)=30 OR ASC(R$)=31 THEN 50130
50122 IF R$=CHR$(0)+CHR$(80) THEN R$=CHR$(31)
50123 IF R$=CHR$(0)+CHR$(72) THEN R$=CHR$(30)
50124 IF R$="2" THEN R$=CHR$(31)
50125 IF R$="8" THEN R$=CHR$(30)
50130 IF ASC(R$)=13 THEN 50190
50140 IF F%=C.F% AND ASC(R$)<>31 THEN 50120
50145 IF F%=L.F% AND ASC(R$)=31 AND NOMENU%=1 THEN LOCATE F%,C%:PRINT SPC(1):F%=C.F%:GOTO 50050
50150 IF F%=L.F% AND ASC(R$)=31 THEN COLOR 11:LOCATE F%,C%:PRINT TABRUT$(I.A%):F%=C.F%:GOTO 50050
50160 IF NOMENU%=1 THEN LOCATE F%,C%:PRINT SPC(1) ELSE COLOR 11:LOCATE F%,C%:PRINT TABRUT$(I.A%)
50170 IF ASC(R$)=30 THEN F%=F%-1
50180 IF ASC(R$)=31 THEN F%=F%+1
50190 WEND
50200 COLOR 15
50300 RETURN
50340 '
50510 '
63000 '********************************
63010 '***RUTINA DE ENTRADA NUMERICA***
63020 '********************************
63030 '
63040 D.E$="":I.T%=0
63050 LOCATE F.C1%,C.C1%,1,0,7
63060 FOR JMG%=1 TO L.E%
63070  D.R$=INPUT$(1)
63080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 63200  '===>AL NEXT
63090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 63200  '===>AL NEXT
63100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 63200  '===>AL NEXT
63110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 63200   '===>AL NEXT
63120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 63200   '===>AL NEXT
63130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%,"-"):LOCATE F.C1%,C.C1%
63140  IF D.R$<"0" OR D.R$>"9" THEN 63170               'Error
63150  D.E$=D.E$+D.R$:PRINT D.R$;
63160  GOTO 63200 'AL NEXT
63170  'Error.
63175  IF ASC(D.R$)=8 AND JMG%=1 THEN 63190
63180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT "-":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
63190  JMG%=JMG%-1
63200 NEXT JMG%
63210 IF I.T%<>0 THEN 63230
63220 IF LEN(D.E$)<>L.E% THEN D.E$=LEFT$(CERO$,L.E%-LEN(D.E$))+D.E$
63225 IF ESC%=1 THEN LOCATE F.C1%,C.C1%:PRINT D.E$
63230 RETURN
63240 '
64000 '*************************************
64010 '***RUTINA DE ENTRADA ALFA/NUMERICA***
64020 '*************************************
64030 '
64040 D.E$="":I.T%=0
64050 LOCATE F.C1%,C.C1%,1,0,7
64060 FOR JMG%=1 TO L.E%
64070  D.R$=INPUT$(1)
64080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 64200  '===>AL NEXT
64090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 64200  '===>AL NEXT
64100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 64200  '===>AL NEXT
64110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 64200   '===>AL NEXT
64120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 64200   '===>AL NEXT
64130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," "):LOCATE F.C1%,C.C1%
64135  IF ASC(D.R$)=34 THEN 64170
64140  IF ASC(D.R$)<32 OR ASC(D.R$)>126 THEN 64170               'Error
64150  D.E$=D.E$+D.R$:PRINT D.R$;
64160  GOTO 64200 'AL NEXT
64170  'Error.
64172  IF D.R$="¥" OR D.R$="¤" THEN 64150
64175  IF ASC(D.R$)=8 AND JMG%=1 THEN 64190
64180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
64190  JMG%=JMG%-1
64200 NEXT JMG%
64210 IF I.T%<>0 THEN 64230
64220 'LOCATE F.C1%,C.C1%:PRINT SPC(L.E%)
64225 'LOCATE F.C1%,C.C1%:PRINT D.E$
64230 RETURN
64240 '
