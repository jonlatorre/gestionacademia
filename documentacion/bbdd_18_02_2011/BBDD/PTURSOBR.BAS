10 '                       PTURSOBR.BAS
20 '                      --------------
30 '                LISTAR SOBRES PARA ALUMNOS
40 '                --------------------------
42 '
50 ON ERROR GOTO 9100
52 '
54 CLS
56 GOSUB 33000 'COGER DATOS DE LA EMPRESA.
60 WIDTH "LPT1:",132:OPEN "LPT1:" FOR OUTPUT AS #9
62     LPRINT CHR$(27)+"&l1O"+CHR$(27)+"(s10h0B";
64 'LPRINT CHR$(27) "C" CHR$(72);:LPRINT CHR$(15)
70 '
80 KEY 1,CHR$(14):KEY 7,CHR$(7):KEY 8,CHR$(9):KEY 10,CHR$(10)
82 KEY 2,CHR$(15):KEY 3,CHR$(16):KEY 4,CHR$(17)
90 CERO$=STRING$(15,"0"):BLANCO$=STRING$(20," ")
92 FECHA$=MID$(DATE$,4,2)+"/"+LEFT$(DATE$,2)+"/"+RIGHT$(DATE$,2)
94 '
100 ENTER$=CHR$(17)+CHR$(196)+CHR$(217)
132 '
134 '
140 DEFSTR C
150 '
160 '
170 OPTION BASE 1
180 DIM TABNOM$(3),TABDIR$(3),TABPLA$(3),TABENT$(30)
190 '
260 GOSUB 15000  'CARGA TABLA DE PROVINCIAS
270 '
300 '**********************************
310 '***PRESENTAMOS MENU EN PANTALLA***
320 '**********************************
330 TIT$="- LISTADO DE SOBRES DE ALUMNOS -"
340 X%=80-LEN(TIT$)
350 X%=INT(X%/2)
360 GOSUB 8000
370 LOCATE 5,X%:PRINT TIT$
380 LOCATE 6,X%:PRINT STRING$(LEN(TIT$),205)
390 LOCATE 8,23:PRINT "1.- LISTADO DE TODOS LOS ALUMNOS."
400 LOCATE 10,23:PRINT "2.- LISTADO ENTRE ALUMNOS."
405 LOCATE 12,23:PRINT "3.- FIN DE PROGRAMA."
410 '
420 LOCATE 16,28:PRINT "Seleccione Opci¢n : < >"
430 '
432 LOCATE 18,29:COLOR 12:PRINT " ESC ";:COLOR 15:PRINT " Terminar listado"
440 '
450 LOCATE 16,49,1,0,6:OPC$=INPUT$(1)
460 IF OPC$<"1" OR OPC$>"3" THEN BEEP:GOTO 450
462 LOCATE 16,49:PRINT OPC$
470 IF OPC$="3" THEN CLOSE:RUN "PTURCLIE"
480 IF OPC$="1" THEN DESDE$="00001":HASTA$="99999":GOTO 550  'PEDIR CONFORMIDAD A LOS DATOS.
490 IF OPC$="2" THEN LOCATE 20,19:PRINT "DESDE EL : <     >   HASTA EL : <     >"
500 '
510 F.C1%=20:C.C1%=31:L.E%=5:BO%=5:ESC%=1:GOSUB 63000
520 IF I.T%<>0 THEN BEEP:GOTO 510
530 DESDE$=D.E$:LOCATE 20,31:PRINT DESDE$
532 F.C1%=20:C.C1%=52:L.E%=5:BO%=5:ESC%=1:GOSUB 63000
534 IF I.T%<>0 THEN BEEP:GOTO 532
536 HASTA$=D.E$:LOCATE 20,52:PRINT HASTA$
538 IF DESDE$>HASTA$ THEN 510
540 '
550 GOSUB 8500:MEN$="DATOS CORRECTOS "+ENTER$+" , DATOS ERRONEOS -F1-":GOSUB 8500
560 A$=INPUT$(1)
570 IF ASC(A$)<13 OR ASC(A$)>14 THEN BEEP:GOTO 560
580 IF ASC(A$)=13 THEN 650   'CONTINUAR.
590 LOCATE 14,49:PRINT SPC(1)
600 LOCATE 16,46:PRINT SPC(5)
610 GOSUB 8500
620 GOTO 310
630 '
640 '*****************
650 '***TRATAMIENTO***
660 '*****************
730 'GOSUB 8500:MEN$="-- COLOCA EL PRIMER SOBRE Y PULSA UNA TECLA --":GOSUB 8500
740 'A$=INPUT$(1)
745 FALUDAT$="FTURALUM.DAT"
750 GOSUB 8500:MEN$="Espere por favor...":GOSUB 8500
760 GOSUB 30010   'apertura del P.C.
770 FF$="":I.T%=0:REG%=1
780 '
790 GOSUB 3000    'LECTURA DEL PLAN CONTABLE
800 '
820 IF FF$="FF" THEN GOSUB 8500:MEN$="NO HAY DATOS, PULSE UNA TECLA":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 310
830 '
840 WHILE FF$<>"FF"
862   NOM$=CNOMBRE:APE1$=CAPELL1:APE2$=CAPELL2
864   GOSUB 40000
890   CODPRO%=VAL(LEFT$(CCOPOS,2))
900   IF CODPRO%=0 OR CODPRO%>50 THEN POBLA$=CPOBLA:GOTO 912
910   POBLA$=CCOPOS+" "+CPOBLA
912   GOSUB 31000:GOSUB 2700
914   GOSUB 8500:MEN$="COLOCA EL SOBRE Y PULSA UNA TECLA":GOSUB 8500
916   A$=INPUT$(1)
920   GOSUB 1010  'SACAR LINEA
930   GOSUB 3000    'LECTURA DEL SIGUIENTE
940 '
950 WEND
970 '
980 CLOSE
990 GOTO 310
992 '
1000 '*****************
1010 '***SACAR LINEA***
1020 '*****************
1030 FOR A%=1 TO 20:LPRINT:NEXT A%
1040 LPRINT TAB(73) NOMBRE$
1080 LPRINT TAB(73) CDIREC
1120 LPRINT TAB(73) POBLA$
1152 LPRINT CHR$(12)
1154 '
1220 RETURN
1230 '
2700 '***********************************
2702 '***PRESENTAMOS DATOS EN PANTALLA***
2704 '***********************************
2728 COLOR 15
2729 GUAPRI#=VAL(CCUENTA):GOSUB 64770:LOCATE 6,19-L.C%:PRINT GUAPRI$
2730 LOCATE 6,59:PRINT CNOMBRE
2740 LOCATE 7,14:PRINT CAPELL1
2750 LOCATE 7,59:PRINT CAPELL2
2760 LOCATE 8,14:PRINT CDIREC
2770 LOCATE 9,14:PRINT CPOBLA
2780 LOCATE 9,59:PRINT CPROVI
2790 LOCATE 10,14:PRINT CCOPOS
2800 LOCATE 10,59:PRINT CTELEFO+" "+CTELEFA
2810 LOCATE 11,14:PRINT CDNI
2820 LOCATE 11,59:PRINT CCURSO
2825 IF CCURSO="1" THEN LOCATE 11,62:PRINT "PRIMERO":GOTO 2840
2826 IF CCURSO="2" THEN LOCATE 11,62:PRINT "SEGUNDO":GOTO 2840
2828 IF CCURSO="3" THEN LOCATE 11,62:PRINT "TERCERO":GOTO 2840
2830 IF CCURSO="4" THEN LOCATE 11,62:PRINT "CUARTO":GOTO 2840
2832 LOCATE 11,62:PRINT "QUINTO":GOTO 2840
2840 LOCATE 12,14:PRINT RIGHT$(CFENA,2)"-"MID$(CFENA,3,2)"-"LEFT$(CFENA,2)
2845 LOCATE 12,59:PRINT RIGHT$(CFALTA,2)"-"MID$(CFALTA,3,2)"-"LEFT$(CFALTA,2)
2871 'BUSCA$=CBANCO:GOSUB 34260
2872 'IF SW1%=0 THEN BA$=LEFT$(BNOM,25):BANC$=CBANCO:GOTO 2874
2873 'BA$="NO EXISTE":BANC$=""
2874 LOCATE 13,14:PRINT CBANCO
2875 'LOCATE 13,19:PRINT BA$
2876 'IF CBANCO<>"2095" THEN 2881
2877 'CUPRI$=LEFT$(CCUBAN,10):EDI$="1":GOSUB 37000
2878 'IF DI%=1 THEN 2881
2879 '
2880 'LOCATE 13,59:PRINT CUPRIE$:GOTO 2882
2881 LOCATE 13,59:PRINT CCUBAN
2882 LOCATE 14,14:PRINT CSUCUR+"-"+CDIGI
2883 LOCATE 14,59:PRINT CESCUE
2884 IF CESCUE="T" THEN LOCATE 14,62:PRINT "TURISMO     ":GOTO 2887
2886 LOCATE 14,62:PRINT "SECRETARIADO"
2887 LOCATE 16,23:PRINT COBSE1
2888 LOCATE 17,23:PRINT COBSE2
2975 RETURN
3000 '********************************
3010 '***LECTURA DE INDICES Y DATOS***
3020 '********************************
3030 REG%=REG%+1
3032 TECLA$=INKEY$:IF TECLA$="" THEN 3040
3034 IF ASC(TECLA$)=27 THEN FF$="FF":RETURN
3040 IF REG%>ULTIMO% THEN FF$="FF":RETURN
3060 IF REG%<VAL(DESDE$) THEN 3030
3070 IF REG%>VAL(HASTA$) THEN FF$="FF":RETURN
3110 GET #2,REG%
3120 IF CSTATUS<>"O" THEN 3030
3130 IF CMARCA= "L" THEN 3030
3140 RETURN
3150 '
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:COLOR 10:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 11:LOCATE 2,3:PRINT" " EMPRESA$" ":COLOR 10:LOCATE 2,34:PRINT "Aplicaci¢n : ACADEMIAS ":COLOR 11:LOCATE 2,63:PRINT "FECHA : "FECHA$" ":COLOR 10 : LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188)
8070 'FOR J%=4 TO 21 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8090 LOCATE 22,1:PRINT CHR$(186):COLOR 11:LOCATE 22,3:PRINT "Mensajes: ":COLOR 10:LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 COLOR 11:RETURN
8120 '
8250 '
8500 '***************************
8510 '***IMPRESION DE MENSAJES***
8520 '***************************
8530 L.L$=""+MEN$+"":LOCATE 22,15:PRINT L.L$;
8550 MEN$=SPACE$(65)
8560 RETURN
8570 '
9000 '*********************
9010 '***FIN DE PROGRAMA***
9020 '*********************
9030 CLOSE
9040 CLS
9050 RUN "PACACLIE"
9060 '
9070 '
9080 END
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9130 IF ERR=34 OR ERR=25 OR ERR=27 THEN GOSUB 8500:MEN$="COMPRUEBE LA IMPRESORA Y PULSE UNA TECLA":GOSUB 8500:A$=INPUT$(1):GOSUB 8500:RESUME
9140 '
9150 '
9160 '
9170 '
9180 '
9190 ON ERROR GOTO 0
9200 '
15000 '***************************************
15010 '***CARGAMOS LAS TABLAS DE PROVINCIAS***
15020 '***************************************
15030 DIM TPRO$(50)
15040 DATA "ALAVA","ALBACETE","ALICANTE","ALMERIA","AVILA","BADAJOZ","BALEARES","BARCELONA","BURGOS","CACERES","CADIZ","CASTELLON","CIUDAD REAL","CORDOBA","LA CORU¥A","CUENCA","GERONA","GRANADA","GUADALAJARA","GUIPUZCOA","HUELVA"
15050 DATA "HUESCA","JAEN","LEON","LERIDA","RIOJA","LUGO","MADRID","MALAGA","MURCIA","NAVARRA","ORENSE","ASTURIAS","PALENCIA","LAS PALMAS","PONTEVEDRA","SALAMANCA","STA. CRUZ TENERIFE","CANTABRIA","SEGOVIA","SEVILLA","SORIA","TARRAGONA"
15060 DATA "TERUEL","TOLEDO","VALENCIA","VALLADOLID","VIZCAYA","ZAMORA","ZARAGOZA"
15070 FOR I%=1 TO 50
15080    READ TPRO$(I%)
15090 NEXT I%
15100 '
15110 RETURN
15120 '
30000 '*******************************
30010 '***APERTURA FICHERO ALUMNOS ***
30020 '*******************************
30025 '
30090 ' Apertura del fichero de datos   FTURALUM.DAT
30100 OPEN "R",#2,FALUDAT$,350
30110 FIELD #2,5 AS CCUENTA,1 AS CSTATUS,20 AS CNOMBRE,20 AS CAPELL1,20 AS CAPELL2,40 AS CDIREC,20 AS CPOBLA,15 AS CPROVI,5 AS CCOPOS,7 AS CTELEFO,7 AS CTELEFA,13 AS CDNI,1 AS CCURSO
30112 FIELD #2,174 AS TODO1$,6 AS CFENA,4 AS CBANCO,4 AS CSUCUR,2 AS CDIGI,14 AS CKAKA1,10 AS CCUBAN,7 AS CKAKA2,6 AS CFALTA,1 AS CMARCA,50 AS COBSE1,50 AS COBSE2,4 AS CFACT
30113 FIELD #2,250 AS TODO3$,82 AS TODO4$,8 AS CIMPOR,1 AS CESCUE,9 AS CFILL
30114 FIELD #2,5 AS CCUEN1,1 AS CSTAT,2 AS CULTI,2 AS CULTACT,12 AS CFICHER,1 AS CSWG,1 AS CSWA,2 AS CVIGO,235 AS REST1$,4 AS CFEFAC,85 AS REST2$
30115 GET #2,1
30116 'IF CFICHER<>"FTURALUM.DAT" THEN 9144
30117  ULTIMO%=CVI(CULTI)
30118  ULTACT%=CVI(CULTACT):N.R%=ULTACT%
30120  VIVAS%=CVI(CVIGO)
30140 RETURN
30150 '
31000 '**********************************************
31010 '***PRESENTAMOS PANTALLA DE ENTRADA DE DATOS***
31020 '**********************************************
31025 GOSUB 8000
31030 COLOR 10:X%=80-LEN(TIT$):X%=INT(X%/2)
31040 LOCATE 4,X%:PRINT TIT$
31042 LOCATE 5,X%:PRINT STRING$(LEN(TIT$),205)
31050 COLOR 11:LOCATE 6,1:PRINT "Alumno N§ : <" SPACE$(6) ">"
31052 LOCATE 6,46:PRINT "Nombre    : <" SPACE$(20) ">"
31054 LOCATE 7,1:PRINT "Apellido 1: <" SPACE$(20) ">"
31056 LOCATE 7,46:PRINT "Apellido 2: <" SPACE$(20) ">"
31058 LOCATE 8,1:PRINT "Direcci¢n : <" SPACE$(40) ">"
31060 LOCATE 9,1:PRINT "Poblaci¢n : <" SPACE$(20) ">"
31062 LOCATE 9,46:PRINT "Provincia : <" SPACE$(15) ">"
31064 LOCATE 10,1:PRINT "CD.Postal : <" SPACE$(5) ">"
31066 LOCATE 10,46:PRINT "Tel‚fonos : <" SPACE$(15) ">"
31068 LOCATE 11,1:PRINT "D.N.I.    : <" SPACE$(13) ">"
31070 LOCATE 11,46:PRINT "Curso     : <" SPACE$(1) ">"
31092 LOCATE 12,1:PRINT "F. Nacim. : <"SPACE$(8) ">"
31094 LOCATE 12,46:PRINT "F. Alta.  : <        >"
31196 LOCATE 13,1:PRINT "Banco     : <" SPACE$(4) ">"
31198 LOCATE 13,46:PRINT "N.Cuenta  : <" SPACE$(10) ">"
31199 LOCATE 14,1:PRINT "Ofic.Digit: <" SPACE$(7) ">"
31200 LOCATE 14,46:PRINT "Escuela   : <" SPACE$(1) ">" SPACE$(15)
31201 LOCATE 16,6:PRINT "Observaciones 1 <" SPACE$(50) ">"
31202 LOCATE 17,6:PRINT "              2 <" SPACE$(50) ">"
31260 COLOR 15:RETURN
31270 '
33000 '**********************************
33010 '***APERTURA FICHERO DATOS FIJOS***
33020 '**********************************
33030 OPEN "R",#1,"FDATFIJ.DAT",100
33040 FIELD #1,2 AS NRO$,8 AS NDIRE$,30 AS NEMPRESA$,15 AS NNIF$,8 AS NPROG$,37 AS NFILLER$
33050 GET #1,1
33052 NROEM$=NRO$
33060 DIRE$=NDIRE$
33070 EMPRESA$=NEMPRESA$
33080 NIF$=NNIF$
33082 PROGRAMA$=NPROG$
33090 CLOSE
33100 '
33110 '
33120 RETURN
33130 '
40000 '
40010 NOMBRE$=""
40020 'Bucle del Nombre.
40030 LONG%=LEN(NOM$)
40040 FOR I%=LONG% TO 1 STEP -1
40050    IF MID$(NOM$,I%,1)<>" " THEN LNOMBRE%=I%:I%=0
40060 NEXT I%
40070 '
40080 'Bucle del Apellido 1.
40090 LONG%=LEN(APE1$)
40100 FOR I%=LONG% TO 1 STEP -1
40110    IF MID$(APE1$,I%,1)<>" " THEN LAPELL1%=I%:I%=0
40120 NEXT I%
40130 '
40140 'Bucle del Apellido 2.
40150 LONG%=LEN(APE2$)
40160 FOR I%=LONG% TO 1 STEP -1
40170    IF MID$(APE2$,I%,1)<>" " THEN LAPELL2%=I%:I%=0
40180 NEXT I%
40190 NOMBRE$=LEFT$(NOM$,LNOMBRE%)+" "+LEFT$(APE1$,LAPELL1%)+" "+LEFT$(APE2$,LAPELL2%)
40200 NOMBRE$=LEFT$(NOMBRE$,50)
40210 RETURN
40220 '
44444 '********************************************
44454 '***RUTINA PARA EDITAR CAMPOS EN CRISTIANO***
44464 '********************************************
44466 IF GUAPRI#>0 AND GUAPRI#<1 THEN GUAPRI$="0":RETURN
44468 IF GUAPRI#<0 AND GUAPRI#>-1 THEN GUAPRI$="0":RETURN
44474 IF GUAPRI#<0 AND GUAPRI#>-1 THEN GUAPRI$=" 0":RETURN
44484 IF GUAPRI#>0 AND GUAPRI#<1 THEN GUAPRI$=" 0":RETURN
44494 GUAPRI$=STR$(GUAPRI#)
44504 SIGNO$=LEFT$(GUAPRI$,1)
44514 GUAPRI$=RIGHT$(GUAPRI$,LEN(GUAPRI$)-1)
44524 'BUSCAMOS SI TIENE DECIMALES.
44534 PUNTO%=0
44544 FOR CRIS%=LEN(GUAPRI$) TO 1 STEP -1
44554  IF MID$(GUAPRI$,CRIS%,1)="." THEN PUNTO%=CRIS%:CRIS%=0
44564 NEXT CRIS%
44574 'DIVIDIMOS EN ENTEROS Y DECIMALES.
44584 IF PUNTO%=0 THEN ENTERO$=GUAPRI$:L.EN%=LEN(ENTERO$):DECIMAL$="":L.DE%=0:GOTO 44624
44594 ENTERO$=LEFT$(GUAPRI$,PUNTO%-1):L.EN%=LEN(ENTERO$):ENTERO#=VAL(ENTERO$)
44604 DECIMAL$=RIGHT$(GUAPRI$,LEN(GUAPRI$)-PUNTO%):L.DE%=LEN(DECIMAL$)
44614 IF LEN(DECIMAL$)<2 THEN DECIMAL$=DECIMAL$+"0":L.DE%=LEN(DECIMAL$)
44624 'REDONDEAMOS LOS DECIMALES
44634 IF DECIMAL$="" THEN 44764  'CONTINUAR
44644 DECA$=LEFT$(DECIMAL$,2)+"."+RIGHT$(DECIMAL$,L.DE%-2)
44654 DECA#=VAL(DECA$)
44664 DECA#=INT(DECA#+.5)
44674 IF DECA#>99 THEN 44734   'SUMAR 1 A ENTERO Y DECIMALES = '00'
44684 DECA$=STR$(DECA#):DECA$=RIGHT$(DECA$,2)
44694 IF LEN(DECA$)<>2 THEN DECA$="0"+DECA$
44704 IF LEFT$(DECA$,1)=" " THEN DECA$="0"+RIGHT$(DECA$,1)
44714 DECIMAL$=DECA$
44724 GOTO 44764  'CONTINUAR
44734 ENTERO#=ENTERO#+1
44744 ENTERO$=STR$(ENTERO#):ENTERO$=RIGHT$(ENTERO$,LEN(ENTERO$)-1):L.EN%=LEN(ENTERO$)
44754 DECIMAL$="00":L.DE%=2
44764 'CONTINUAMOS
44774 CAMPO$="":X%=0
44784 FOR CRIS%=L.EN% TO 1 STEP -1
44794  X%=X%+1
44804  IF X%=4 THEN CAMPO$=CAMPO$+".":X%=1
44814  CAMPO$=CAMPO$+MID$(ENTERO$,CRIS%,1)
44824 NEXT CRIS%
44834 GUAPRI$=""
44844 FOR CRIS%=LEN(CAMPO$) TO 1 STEP -1
44854  GUAPRI$=GUAPRI$+MID$(CAMPO$,CRIS%,1)
44864 NEXT CRIS%
44874 IF GUAPRI$="" THEN GUAPRI$="0"
44884 'GUAPRI$=SIGNO$+GUAPRI$
44894 IF DECIMAL$<>"" THEN GUAPRI$=GUAPRI$+","+LEFT$(DECIMAL$,2)
44904 RETURN
63000 '********************************
63010 '***RUTINA DE ENTRADA NUMERICA***
63020 '********************************
63030 W.LE%=L.E%
63040 D.E$="":I.T%=0
63050 LOCATE F.C1%,C.C1%:PRINT SPC(BO%)
63060 LOCATE F.C1%,C.C1%,1,0,6
63070 L.E%=W.LE%+NEG%
63080 FOR JMG%=1 TO L.E%
63090  D.R$=INPUT$(1)
63100  IF ASC(D.R$)=13 AND JMG%=1 THEN I.T%=1:JMG%=L.E%:L.D%=0:D.E$="":GOTO 63270
63110  IF ASC(D.R$)=13 AND L.D%<>0 THEN JMG%=L.E%:D.R$=".":D.E$=D.E$+D.R$:PRINT D.R$;:GOTO 63270'AL NEXT
63120  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 63270  'AL NEXT
63130  IF ASC(D.R$)=10 THEN I.T%=2:JMG%=L.E%:L.D%=0:D.E$="":GOTO 63270 'AL NEXT
63140  IF ASC(D.R$)=9 THEN I.T%=3:JMG%=L.E%:L.D%=0:D.E$="":GOTO 63270  'AL NEXT
63150  IF ASC(D.R$)=7 OR ASC(D.R$)=27 THEN I.T%=4:JMG%=L.E%:L.D%=0:D.E$="":GOTO 63270  'AL NEXT
63160  IF D.R$<"0" OR D.R$>"9" THEN 63200 'MIRAR EL POSIBLE ERROR.
63170  IF JMG%=1 AND NEG%=1 THEN D.E$=D.E$+" ":PRINT " ";:JMG%=2
63180  D.E$=D.E$+D.R$:PRINT D.R$;
63190  GOTO 63270 'AL NEXT
63200  'MIRAR POSIBLE ERROR.
63210  IF D.R$="-" AND NEG%=1 AND JMG%=1 THEN D.E$=D.E$+D.R$:PRINT D.R$;:GOTO 63270 'AL NEXT
63220  IF ASC(D.R$)=46 OR ASC(D.R$)=44 AND L.D%=0 THEN D.R$=".":D.E$=D.E$+D.R$:PRINT D.R$;:JMG%=L.E%:GOTO 63270 'AL NEXT
63230  IF ASC(D.R$)<>8 THEN 63090
63240  IF JMG%=1 THEN 63090
63250  LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-2
63260  '
63270 NEXT JMG%
63280 IF L.D%=0 THEN 63500
63290 IF RIGHT$(D.E$,1)="." THEN 63310 'CONTINUAR
63300 D.E$=D.E$+".":PRINT ".";
63310 LOCATE F.C1%,C.C1%+LEN(D.E$)
63320 WJMG%=JMG%
63330 FOR JMG2%=1 TO L.D%
63340  D.R$=INPUT$(1)
63350  IF ASC(D.R$)=13 AND JMG2%=1 AND I.T%=1 THEN I.T%=1:JMG2%=L.D%:GOTO 63490
63360  IF ASC(D.R$)=13 AND JMG2%=1 AND I.T%=0 THEN I.T%=0:JMG2%=L.D%:GOTO 63490
63370  IF ASC(D.R$)=13 THEN JMG2%=L.D%:GOTO 63490  'AL NEXT
63380  IF ASC(D.R$)=10 THEN I.T%=2:JMG2%=L.D%:D.E$="":GOTO 63490 'AL NEXT
63390  IF ASC(D.R$)=9 THEN I.T%=3:JMG2%=L.D%:D.E$="":GOTO 63490  'AL NEXT
63400  IF ASC(D.R$)=7 OR ASC(D.R$)=27 THEN I.T%=4:JMG2%=L.D%:D.E$="":GOTO 63490  'AL NEXT
63410  IF D.R$<"0" OR D.R$>"9" THEN 63440 'MIRAR EL POSIBLE ERROR.
63420  D.E$=D.E$+D.R$:PRINT D.R$;
63430  GOTO 63490 'AL NEXT
63440  'MIRAR POSIBLE ERROR
63450  IF ASC(D.R$)<>8 THEN 63340
63460  IF JMG2%=1 THEN 63040 'AL PRINCIPIO
63470  LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG2%=JMG2%-2
63480  '
63490 NEXT JMG2%
63500 IF I.T%<>0 THEN RETURN
63510 IF LEFT$(D.E$,1)="-" THEN RETURN
63520 IF L.D%<>0 THEN RETURN
63530 '
63540 IF LEN(D.E$)<>L.E% THEN D.E$=LEFT$(CERO$,L.E%-LEN(D.E$))+D.E$
63550 RETURN
63560 '
64000 '*************************************
64010 '***RUTINA DE ENTRADA ALFA/NUMERICA***
64020 '*************************************
64030 '
64040 D.E$="":I.T%=0
64050 LOCATE F.C1%,C.C1%,1,0,6
64060 FOR JMG%=1 TO L.E%
64070  D.R$=INPUT$(1)
64080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 64200  '===>AL NEXT
64090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 64200  '===>AL NEXT
64100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 64200  '===>AL NEXT
64110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 64200   '===>AL NEXT
64120  IF ASC(D.R$)=7 OR ASC(D.R$)=27 THEN JMG%=L.E%:I.T%=4:GOTO 64200   '===>AL NEXT
64130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," "):LOCATE F.C1%,C.C1%
64135  IF ASC(D.R$)=34 THEN 64170
64140  IF ASC(D.R$)<32 OR ASC(D.R$)>126 THEN 64170               'Error
64150  D.E$=D.E$+D.R$:PRINT D.R$;
64160  GOTO 64200 'AL NEXT
64170  'Error.
64175  IF ASC(D.R$)=8 AND JMG%=1 THEN 64190
64180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
64190  JMG%=JMG%-1
64200 NEXT JMG%
64210 IF I.T%<>0 THEN 64230
64220 LOCATE F.C1%,C.C1%:PRINT SPC(L.E%)
64225 LOCATE F.C1%,C.C1%:PRINT D.E$
64230 RETURN
64240 '
64760 '========================================================================
64762 ' RUTINA PARA EDITAR IMPORTES EN CRISTIANO X.XXX.XXX,XX                 =
64764 '                                                                       =
64766 ' SE ENTRARA A ESTA RUTINA DE LA FORMA  SIGUIENTE:                      =
64768 '                                                                       =
64770 ' GOSUB 64760 MANDANDO EN UN CAMPO LLAMADO GUAPRI#,                     =
64772 '                                                                       =
64773 '             LA CANTIDAD O NUMERO QUE DESEEMOS EDITAR.                 =
64774 '                                                                       =
64775 '             Y EN UN CAMPO LLAMADO N.D% EL NUMERO DE DECIMALES         =
64776 '                                                                       =
64778 ' DEVOLVERA EL CAMPO EDITADO EN GUAPRI$ Y LA LONGITUD EN L.C%           =
64780 '                                                                       =
64782 '========================================================================
64784 '
64786 '
64788 GUAPRI$=STR$(GUAPRI#):L.P%=0:N.D%=0
64790 FOR I%=1 TO 30:TABENT$(I%)="":NEXT I%
64792 SIGNO$=LEFT$(GUAPRI$,1):GUAPRI$=RIGHT$(GUAPRI$,LEN(GUAPRI$)-1)
64794 FOR I%=1 TO LEN(GUAPRI$)
64796   IF MID$(GUAPRI$,I%,1)="." THEN L.P%=I%:I%=LEN(GUAPRI$)
64798 NEXT I%
64800 IF L.P%=0 THEN DEC$="":ENT$=GUAPRI$:GOTO 64812
64802 IF N.D%=0 THEN DEC$="":GOTO 64808
64804 DEC$=","+MID$(GUAPRI$,L.P%+1,N.D%)
64806 IF LEN(DEC$)<>N.D%+1 THEN DEC$=DEC$+LEFT$(CERO$,N.D%+1-LEN(DEC$))
64808 ENT$=LEFT$(GUAPRI$,L.P%-1)
64810 IF LEN(ENT$)=0 THEN GUAPRI$="0":GOTO 64834
64812 X%=31
64814 FOR I%=LEN(ENT$) TO 1 STEP -1
64816   X%=X%-1
64818   IF X%=27 OR X%=23 OR X%=19 OR X%=15 OR X%=12 THEN TABENT$(X%)=".":X%=X%-1
64820   TABENT$(X%)=MID$(ENT$,I%,1)
64822 NEXT I%
64824 GUAPRI$=""
64826 FOR I%=1 TO 30
64828   IF TABENT$(I%)="" THEN 64832
64830   GUAPRI$=GUAPRI$+TABENT$(I%)
64832 NEXT I%
64833 IF SIGNO$=" " THEN GUAPRI$=GUAPRI$+DEC$:L.C%=LEN(GUAPRI$)-1:RETURN
64834 GUAPRI$=GUAPRI$+DEC$+SIGNO$:L.C%=LEN(GUAPRI$)-1
64836 RETURN
64838 '
