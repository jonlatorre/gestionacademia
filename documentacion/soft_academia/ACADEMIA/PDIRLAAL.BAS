10 '                       PDIRLAAL.BAS
20 '                      --------------
30 '         LISTADO ALFABETICO DE DIRECCIONES DE CARTAS
40 '         -------------------------------------------
52 '
54 '
56 '
60 ON ERROR GOTO 9100
70 '
80 KEY 1,CHR$(14):KEY 7,CHR$(7):KEY 8,CHR$(9):KEY 10,CHR$(10)
82 KEY 2,CHR$(15):KEY 3,CHR$(16):KEY 4,CHR$(17)
90 CERO$=STRING$(15,"0"):BLANCO$=STRING$(60," ")
100 '
132 GOSUB 33000
133 FECHA$=MID$(DATE$,4,3)+LEFT$(DATE$,3)+RIGHT$(DATE$,2)
140 DEFSTR C,G,B,F
150 OPTION BASE 1
200 DIM TABENT$(30)
520 '
570 '
590 '
600 GOTO 4490
3310 '
3490 '***************************************
3500 '***LINEA DE DETALLE LISTADO ALFABET.***
3510 '***************************************
3520 '
3545 IF LIN%>66 THEN GOSUB 3740   '--HACER CABECERAS--
3550 LPRINT TAB(7) CNOMBRE;
3560 GUAPRI#=VAL(CCUENTA):GOSUB 64770:LPRINT TAB(74-L.C%) GUAPRI$;
3570 LPRINT TAB(77) CTELEFO;
3580 LPRINT TAB(89) CCONTA;
3590 LPRINT TAB(121) CTECON
3642 LPRINT:LIN%=LIN%+2
3650 NHASTA$=CNOMBRE
3655 IF LEN(NHASTA$)<40 THEN NHASTA$=NHASTA$+LEFT$(BLANCO$,40-LEN(NHASTA$))
3660 RETURN
3670 '
3730 '************************************
3740 '***CABECERAS DEL LISTADO NUMERICO***
3750 '************************************
3755 IF LIN%= 90 THEN 3760
3757 LPRINT CHR$(12)
3758 INDICE$=NDESDE$+NHASTA$+NPAG$:PRINT #5,INDICE$
3760 PAG%=PAG%+1:LIN%=0
3765 NDESDE$=CNOMBRE:NPAG$=STR$(PAG%)
3767 IF LEN(NDESDE$)<40 THEN NDESDE$=NDESDE$+LEFT$(BLANCO$,40-LEN(NDESDE$))
3770 LPRINT TAB(7) EMPRESA$;
3775 LPRINT TAB(46) "RELACION ALFABETICA DE MAYORISTAS DE LA AGENCIA AL " FECHA$ ;
3790 LPRINT TAB(113) "HOJA NUMERO :";:GUAPRI#=PAG%:GOSUB 64770:LPRINT TAB(131-L.C%) GUAPRI$
3800 LPRINT TAB(7) STRING$(LEN(EMPRESA$),"-");
3805 LPRINT TAB(46) STRING$(59,"-");
3820 LPRINT TAB(113) STRING$(19,"-")
3840 LPRINT
3850 LPRINT TAB(18) "N O M B R E   D E L   M A Y O R I S T A";
3860 LPRINT TAB(69) "NUMERO";
3870 LPRINT TAB(78) "TELEFONO";
3872 LPRINT TAB(94) "PERSONA DE CONTACTO";
3878 LPRINT TAB(122) "TELEFONO"
3900 '
3910 LPRINT TAB(7) STRING$(60,"-");
3912 LPRINT TAB(69) STRING$(6,"-");
3914 LPRINT TAB(77) STRING$(10,"-");
3916 LPRINT TAB(89) STRING$(30,"-");
3918 LPRINT TAB(121) STRING$(10,"-")
3926 'LPRINT
3928 LIN%=LIN%+7
3930 RETURN
3940 '
4480 '*************************
4490 '***INFORME DEL FICHERO***
4491 '*************************
4496 SHELL "DIRALFA.BAT"
4499 '
4500 '
4501 GOSUB 8000
4502 WIDTH "LPT1:",132:OPEN "LPT1:" FOR OUTPUT AS #9
4503 LPRINT CHR$(27) "C" CHR$(72);:LPRINT CHR$(15)
4504 '
4510 COLOR 11
4515 LOCATE 6,19:PRINT "- LISTADO ALFABETICO DE MAYORISTAS AGENCIA -":LOCATE 7,19:PRINT STRING$(44,205)
4550 COLOR 10:LOCATE 12,6:PRINT "DESDE : <                                                            >"
4551 COLOR 10:LOCATE 14,6:PRINT "HASTA : <                                                            >"
4552 COLOR 15:LOCATE 16,25:PRINT " F10";
4554 COLOR 11:PRINT " Volver al Men£ Anterior"
4560 COLOR 15
4590 'Pedimos numero de Orden DESDE.
4593 '
4600 F.C1%=12:C.C1%=15:L.E%=60:BO%=60:GOSUB 64000
4610 IF I.T%=0 THEN LOCATE 12,15:PRINT D.E$:GOTO 4640
4620 IF I.T%=2 THEN CLOSE:GOTO 9000
4630 GOTO 4600
4640 DESDE$=D.E$
4645 IF LEN(DESDE$)<>60 THEN DESDE$=DESDE$+LEFT$(BLANCO$,60-LEN(DESDE$))
4680 GOSUB 8500:MEN$="- HASTA=ZZZZZZZZZZZZZZZZZZZZ, hasta el Fin de Fichero -":GOSUB 8500
4690 COLOR 15    'Pedimos numero de Orden HASTA.
4700 F.C1%=14:C.C1%=15:L.E%=60:BO%=60:GOSUB 64000
4710 IF I.T%=0 THEN LOCATE 14,15:PRINT D.E$:GOTO 4740
4720 IF I.T%=2 THEN CLOSE:GOTO 9000
4730 GOTO 4700
4740 '
4770 HASTA$=D.E$
4780 IF LEN(HASTA$)<>60 THEN HASTA$=HASTA$+LEFT$(BLANCO$,60-LEN(HASTA$))
4790 'Comprobamos DESDE con HASTA.
4800 IF DESDE$>HASTA$ THEN BEEP:GOSUB 8500:MEN$="Nombre   -DESDE-   mayor de   -HASTA-, pursar una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 4501
4801 PAG%=0:LIN%=90
4802   GOSUB 8500
4803   COLOR 10:LOCATE 22,15:PRINT " Datos Correctos ";
4804   COLOR 15:PRINT " ENTER ";
4805   COLOR 10:PRINT " Datos Erroneos ";
4806   COLOR 15:PRINT " F1 "
4807   COLOR 10
4814 A$=INPUT$(1)
4816 IF ASC(A$)=14 THEN CLOSE:GOTO 4490
4818 GOSUB 30000:GOSUB 8500:MEN$=" Espere por Favor........":GOSUB 8500
4820 '
4825 OPEN "O",#5,"INDICES.DAT"
4830 FOR REG%=2 TO ULTIMO%
4840   GET #2,REG%
4842   IF CNOMBRE<DESDE$ THEN 4900     'AL NEXT
4844   IF CNOMBRE>HASTA$ THEN N.L%=ULTIMO%:GOTO 4900  'AL NEXT
4850   IF CSTATUS<>"O" THEN 4900 'AL NEXT
4852   IF CMARCA="L" THEN 4900
4890   GOSUB 3500   'LINEA DE DETALLE.
4900 NEXT REG%
4901 IF LIN%=90 THEN GOSUB 8500:MEN$="No disponemos de los datos pedidos, pulsar una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 4490
4902 LPRINT CHR$(12)
4903 INDICE$=NDESDE$+NHASTA$+NPAG$:PRINT #5,INDICE$
4904 CLOSE #5
4906 GOTO 5000
4908 '
4914 '
4964 CLOSE
4966 GOTO 4500
4968 '
4970 '
5000 OPEN "I",#5,"INDICES.DAT"
5005 LIN%=90
5010 IF EOF(5) THEN LPRINT CHR$(12):GOTO 4964
5020 LINE INPUT #5,INDICE$
5030 DESDE$=LEFT$(INDICE$,40)
5040 HASTA$=MID$(INDICE$,61,40)
5050 PAG$=RIGHT$(INDICE$,LEN(INDICE$)-80)
5060 IF LIN%>67 THEN 6000
5070 LPRINT TAB(15) DESDE$;
5080 LPRINT TAB(65) HASTA$;
5090 LPRINT TAB(116) USING"###";VAL(PAG$)
5100 LPRINT:LIN%=LIN%+2
5110 GOTO 5010
6000 IF LIN%=90 THEN 6010
6005 LPRINT CHR$(12)
6010 LIN%=0
6020 LPRINT TAB(14) "*** AGENCIA DE VIAJES EIDE *** RELACION DE INDICES DEL LISTADO ALFABETICO DE MAYORISTAS HASTA  EL " FECHA$
6040 LPRINT TAB(14) STRING$(106,205)
6050 LPRINT
6060 LPRINT TAB(29) "D  E  S  D  E";
6070 LPRINT TAB(79) "H  A  S  T  A";
6080 LPRINT TAB(115) "HOJA"
6090 LPRINT TAB(15) STRING$(40,205);
6092 LPRINT TAB(65) STRING$(40,205);
6094 LPRINT TAB(115) STRING$(4,205)
6100 LPRINT:LIN%=6
6110 GOTO 5070
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:COLOR 10:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 11:LOCATE 2,3:PRINT EMPRESA$:COLOR 10:LOCATE 2,37:PRINT "Aplicaci¢n : MAYORISTAS ":COLOR 11:LOCATE 2,63:PRINT "FECHA : "FECHA$" ":COLOR 10 : LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188)
8070 'FOR J%=4 TO 21 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8090 LOCATE 22,1:PRINT CHR$(186):COLOR 11:LOCATE 22,3:PRINT "Mensajes: ":COLOR 10:LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 COLOR 15:RETURN
8120 '
8250 '
8490 '*************************
8500 '***IMPRESION DE MENSAJES*
8510 '*************************
8515 '
8520 COLOR 11:L.L$=""+MEN$+"":LOCATE 22,14:PRINT L.L$;
8525 IF RET%=1 THEN FOR H=1 TO 7500:NEXT H:RET%=0
8530 MEN$=SPACE$(64)
8540 RETURN
8550 '
9000 '**********************
9010 '***FIN DEL PROGRAMA***
9020 '**********************
9030 CLOSE
9040 RUN "PDIRCLIE"
9050 END
9060 '
9070 '
9080 '
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9130 IF ERR=24 OR ERR=25 OR ERR=27 THEN GOSUB 8500:MEN$="--COMPRUEBE LA IMPRESORA Y PULSE UNA TECLA---":GOSUB 8500:A$=INPUT$(1):RESUME
9140 GOTO 9150
9142 GOSUB 8500:MEN$="Fichero FDIRCLIE.DAT inexistente, pulsar una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 9000
9144 GOSUB 8500:MEN$="Fichero FDIRCLIE.DAT inexistente, pulsar una tecla":GOSUB 8500:A$=INPUT$(1):CLOSE:GOTO 9000
9150 '
9170 ON ERROR GOTO 0
9180 '
30000 '*******************************
30010 '***APERTURA FICHERO ALUMNOS ***
30020 '*******************************
30525 '
30590 ' Apertura del fichero de datos   FDIRCLIE.DAT
30600 OPEN "R",#2,"FDIRCLIE.ALF",420
30610 FIELD #2,5 AS CCUENTA,1 AS CSTATUS,60 AS CNOMBRE,60 AS CDIREC,30 AS CPOBLA,15 AS CPROVI,10 AS CTECON,5 AS CCOPOS,10 AS CTELEFO,20 AS CNACION
30612 FIELD #2,216 AS TODO1$,1 AS CPAGO,30 AS CCONTA,2 AS CNIN,2 AS CNVE,2 AS CNNA,2 AS CNPU,2 AS CNOF,2 AS CNSS,8 AS CXXX,60 AS COBSE1,60 AS COBSE2,1 AS CMARCA,2 AS CREFE
30613 FIELD #2,250 AS TODO2$,140 AS TODO3$,2 AS CIIN,2 AS CIVE,2 AS CINA,2 AS CIPU,2 AS CIOF,2 AS CISS,1 AS CMEDIAN,17 AS CFIL
30614 FIELD #2,5 AS CCUEN1,1 AS CSTAT,2 AS CULTI,12 AS CFICHER,250 AS CEST1$,150 AS CEST2$
30615  GET #2,1
30616  IF CFICHER<>"FDIRCLIE.DAT" THEN 9144
30617  ULTIMO%=CVI(CULTI)
30630 'FOR A%=2 TO ULTIMO%
30632 'GET #2,A%
30636 'LSET CNIN=MKI$(0):LSET CNVE=MKI$(0):LSET CNNA=MKI$(0):LSET CNPU=MKI$(0):LSET CNOF=MKI$(0):LSET CNSS=MKI$(0)
30638 'LSET CIIN=MKI$(0):LSET CIVE=MKI$(0):LSET CINA=MKI$(0):LSET CIPU=MKI$(0):LSET CIOF=MKI$(0):LSET CISS=MKI$(0)
30640 'PUT #2,A%
30650 'NEXT A%
30652 'CLOSE:STOP
30940 RETURN
33000 '**********************************
33010 '***APERTURA FICHERO DATOS FIJOS***
33020 '**********************************
33030 OPEN "R",#1,"FDATFIJ.DAT",100
33040 FIELD #1,2 AS NRO$,8 AS NDIRE$,30 AS NEMPRESA$,15 AS NNIF$,8 AS NPROG$,37 AS NFILLER$
33050 GET #1,1
33052 NROEM$=NRO$
33060 DIRE$=NDIRE$
33070 EMPRESA$="*** AGENCIA DE VIAJES EIDE ***"
33080 NIF$=NNIF$
33082 PROGRAMA$=NPROG$
33090 CLOSE
33100 '
33110 '
33120 RETURN
33130 '
40000 'Ponemos el Nombre y los dos Apellidos en una linea.
40010 NOMBRE$=""
40020 'Bucle del Nombre.
40030 LONG%=LEN(NOM$)
40040 FOR I%=LONG% TO 1 STEP -1
40050    IF MID$(NOM$,I%,1)<>" " THEN LNOMBRE%=I%:I%=0
40060 NEXT I%
40070 '
40080 'Bucle del Apellido 1.
40090 LONG%=LEN(APE1$)
40100 FOR I%=LONG% TO 1 STEP -1
40110    IF MID$(APE1$,I%,1)<>" " THEN LAPELL1%=I%:I%=0
40120 NEXT I%
40130 '
40140 'Bucle del Apellido 2.
40150 LONG%=LEN(APE2$)
40160 FOR I%=LONG% TO 1 STEP -1
40170    IF MID$(APE2$,I%,1)<>" " THEN LAPELL2%=I%:I%=0
40180 NEXT I%
40190 NOMBRE$=LEFT$(NOM$,LNOMBRE%)+" "+LEFT$(APE1$,LAPELL1%)+" "+LEFT$(APE2$,LAPELL2%)
40200 NOMBRE$=LEFT$(NOMBRE$,50)
40210 RETURN
40220 '
63000 '********************************
63010 '***RUTINA DE ENTRADA NUMERICA***
63020 '********************************
63030 '
63040 D.E$="":I.T%=0
63050 LOCATE F.C1%,C.C1%,1,0,6
63060 FOR JMG%=1 TO L.E%
63070  D.R$=INPUT$(1)
63080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 63200  '===>AL NEXT
63090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 63200  '===>AL NEXT
63100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 63200  '===>AL NEXT
63110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 63200   '===>AL NEXT
63120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 63200   '===>AL NEXT
63130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%,"-"):LOCATE F.C1%,C.C1%
63140  IF D.R$<"0" OR D.R$>"9" THEN 63170               'Error
63150  D.E$=D.E$+D.R$:PRINT D.R$;
63160  GOTO 63200 'AL NEXT
63170  'Error.
63175  IF ASC(D.R$)=8 AND JMG%=1 THEN 63190
63180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT "-":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
63190  JMG%=JMG%-1
63200 NEXT JMG%
63210 IF I.T%<>0 THEN 63230
63220 IF LEN(D.E$)<>L.E% THEN D.E$=LEFT$(CERO$,L.E%-LEN(D.E$))+D.E$
63225 LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," ")
63230 RETURN
63240 '
64000 '*************************************
64010 '***RUTINA DE ENTRADA ALFA/NUMERICA***
64020 '*************************************
64030 '
64040 D.E$="":I.T%=0
64050 LOCATE F.C1%,C.C1%,1,0,6
64060 FOR JMG%=1 TO L.E%
64070  D.R$=INPUT$(1)
64080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 64200  '===>AL NEXT
64090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 64200  '===>AL NEXT
64100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 64200  '===>AL NEXT
64110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 64200   '===>AL NEXT
64120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 64200   '===>AL NEXT
64130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," "):LOCATE F.C1%,C.C1%
64135  IF ASC(D.R$)=34 THEN 64170
64140  IF ASC(D.R$)<32 OR ASC(D.R$)>126 THEN 64170               'Error
64150  D.E$=D.E$+D.R$:PRINT D.R$;
64160  GOTO 64200 'AL NEXT
64170  'Error.
64172  IF D.R$="¥" OR D.R$="¤" THEN 64150
64175  IF ASC(D.R$)=8 AND JMG%=1 THEN 64190
64180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
64190  JMG%=JMG%-1
64200 NEXT JMG%
64210 IF I.T%<>0 THEN 64230
64220 'LOCATE F.C1%,C.C1%:PRINT SPC(L.E%)
64225 'LOCATE F.C1%,C.C1%:PRINT D.E$
64230 RETURN
64240 '
64760 '========================================================================
64762 ' RUTINA PARA EDITAR IMPORTES EN CRISTIANO X.XXX.XXX,XX                 =
64764 '                                                                       =
64766 ' SE ENTRARA A ESTA RUTINA DE LA FORMA  SIGUIENTE:                      =
64768 '                                                                       =
64770 ' GOSUB 64760 MANDANDO EN UN CAMPO LLAMADO GUAPRI#,                     =
64772 '                                                                       =
64773 '             LA CANTIDAD O NUMERO QUE DESEEMOS EDITAR.                 =
64774 '                                                                       =
64775 '             Y EN UN CAMPO LLAMADO N.D% EL NUMERO DE DECIMALES         =
64776 '                                                                       =
64778 ' DEVOLVERA EL CAMPO EDITADO EN GUAPRI$ Y LA LONGITUD EN L.C%           =
64780 '                                                                       =
64782 '========================================================================
64784 '
64786 '
64788 GUAPRI$=STR$(GUAPRI#):L.P%=0:N.D%=0
64790 FOR I%=1 TO 30:TABENT$(I%)="":NEXT I%
64792 SIGNO$=LEFT$(GUAPRI$,1):GUAPRI$=RIGHT$(GUAPRI$,LEN(GUAPRI$)-1)
64794 FOR I%=1 TO LEN(GUAPRI$)
64796   IF MID$(GUAPRI$,I%,1)="." THEN L.P%=I%:I%=LEN(GUAPRI$)
64798 NEXT I%
64800 IF L.P%=0 THEN DEC$="":ENT$=GUAPRI$:GOTO 64812
64802 IF N.D%=0 THEN DEC$="":GOTO 64808
64804 DEC$=","+MID$(GUAPRI$,L.P%+1,N.D%)
64806 IF LEN(DEC$)<>N.D%+1 THEN DEC$=DEC$+LEFT$(CERO$,N.D%+1-LEN(DEC$))
64808 ENT$=LEFT$(GUAPRI$,L.P%-1)
64810 IF LEN(ENT$)=0 THEN GUAPRI$="0":GOTO 64834
64812 X%=31
64814 FOR I%=LEN(ENT$) TO 1 STEP -1
64816   X%=X%-1
64818   IF X%=27 OR X%=23 OR X%=19 OR X%=15 OR X%=12 THEN TABENT$(X%)=".":X%=X%-1
64820   TABENT$(X%)=MID$(ENT$,I%,1)
64822 NEXT I%
64824 GUAPRI$=""
64826 FOR I%=1 TO 30
64828   IF TABENT$(I%)="" THEN 64832
64830   GUAPRI$=GUAPRI$+TABENT$(I%)
64832 NEXT I%
64833 IF SIGNO$=" " THEN GUAPRI$=GUAPRI$+DEC$:L.C%=LEN(GUAPRI$)-1:RETURN
64834 GUAPRI$=GUAPRI$+DEC$+SIGNO$:L.C%=LEN(GUAPRI$)-1
64836 RETURN
64838 '
