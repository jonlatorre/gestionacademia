10 '                       PACACRNA.BAS
20 '                      --------------
30 '             GENERA FICHEROS AUSENCIAS Y NOTAS
40 '             ---------------------------------
50 '
52 ON ERROR GOTO 9100
54 '
56 '
60 '
70 OPTION BASE 1
80 KEY 1,CHR$(14):KEY 7,CHR$(7):KEY 8,CHR$(9):KEY 10,CHR$(10)
82 KEY 2,CHR$(15):KEY 3,CHR$(16):KEY 4,CHR$(17)
90 CERO$=STRING$(15,"0")
92 ENTER$=CHR$(17)+CHR$(196)+CHR$(217)
94 FDIA$=RIGHT$(DATE$,2)+LEFT$(DATE$,2)+MID$(DATE$,4,2)
100 FECHA$=RIGHT$(FDIA$,2)+"/"+MID$(FDIA$,3,2)+"/"+LEFT$(FDIA$,2)
130 GOSUB 8000
140 '*************************
150 '***PRESENTAMOS EL MENU***
160 '*************************
170 TIT$="- GENERACION FICHEROS DE ACADEMIAS -"
180 X%=80-LEN(TIT$)
190 X%=INT(X%/2)
200 '
210 LOCATE 5,X%:PRINT TIT$
220 LOCATE 6,X%:PRINT STRING$(LEN(TIT$),205)
230 '
240 LOCATE 8,17:PRINT "Este proceso solo se puede realizar al principio"
250 LOCATE 9,17:PRINT "del curso escolar, si est s conforme pulsa ENTER"
260 LOCATE 11,25:PRINT "Si no est s conforme pulsa -f1-"
270 A$=INPUT$(1)
280 IF ASC(A$)<13 OR ASC(A$)>14 THEN 270
290 IF ASC(A$)=14 THEN 9000
300 LOCATE 14,17:PRINT "Este proceso solo se puede realizar al principio"
310 LOCATE 15,17:PRINT "del curso escolar, si est s conforme pulsa ENTER"
320 LOCATE 16,25:PRINT "Si no est s conforme pulsa -f1-"
330 A$=INPUT$(1)
340 IF ASC(A$)<13 OR ASC(A$)>14 THEN 330
350 IF ASC(A$)=14 THEN 9000
1500 '********************************
1502 '***APERTURA FICHERO DE FALTAS***
1504 '********************************
1506 FICHE1$="FACAAUSE.DAT"
1508 DEFSTR A,J
1510 'APERTURA FICHERO DE DATOS.
1512 OPEN "R",#5,FICHE1$,48
1514 'REGISTRO DE DATOS.
1515 FIELD #5,2 AS AENE,2 AS AFEB,2 AS AMAR,2 AS AABR,2 AS AMAY,2 AS AJUN,2 AS AJUL,2 AS AAGO,2 AS ASET,2 AS AOCT,2 AS ANOV,2 AS ADIC
1516 FIELD #5,24 AS JTOD,2 AS JENE,2 AS JFEB,2 AS JMAR,2 AS JABR,2 AS JMAY,2 AS JJUN,2 AS JJUL,2 AS JAGO,2 AS JSET,2 AS JOCT,2 AS JNOV,2 AS JDIC
1517 FOR A%=1 TO 9999
1518 GET #5,A%
1519 LSET AENE=MKI$(0):LSET AFEB=MKI$(0):LSET AMAR=MKI$(0):LSET AABR=MKI$(0)
1520 LSET AMAY=MKI$(0):LSET AJUN=MKI$(0):LSET AJUL=MKI$(0):LSET AAGO=MKI$(0)
1522 LSET ASET=MKI$(0):LSET AOCT=MKI$(0):LSET ANOV=MKI$(0):LSET ADIC=MKI$(0)
1526 LSET JENE=MKI$(0):LSET JFEB=MKI$(0):LSET JMAR=MKI$(0):LSET JABR=MKI$(0)
1528 LSET JMAY=MKI$(0):LSET JJUN=MKI$(0):LSET JJUL=MKI$(0):LSET JAGO=MKI$(0)
1530 LSET JSET=MKI$(0):LSET JOCT=MKI$(0):LSET JNOV=MKI$(0):LSET JDIC=MKI$(0)
1532 PUT #5,A%
1533 NEXT A%
1534 CLOSE
1536 '
1590 '********************************
1600 '***APERTURA FICHERO DE NOTAS ***
1601 '********************************
1602 FICHE1$="\"+ESTA$+"\FACANOTA.DAT"
1603 DEFSTR N
1604 'APERTURA FICHERO DE DATOS.
1605 OPEN "R",#6,"FACANOTA.DAT",100
1606 'REGISTRO DE DATOS.
1607 FIELD #6,2 AS NCOE11,2 AS NCOS11,2 AS NCOE12,2 AS NCOS12,2 AS NCOE13,2 AS NCOS13
1608 FIELD #6,12 AS NRE001,2 AS NCOE21,2 AS NCOS21,2 AS NCOE22,2 AS NCOS22,2 AS NCOE23,2 AS NCOS23
1609 FIELD #6,24 AS NRE002,2 AS NCOE31,2 AS NCOS31,2 AS NCOE32,2 AS NCOS32,2 AS NCOE33,2 AS NCOS33
1610 FIELD #6,36 AS NRE003,2 AS NGRE01,2 AS NGRS01,2 AS NGRE02,2 AS NGRS02,2 AS NGRE03,2 AS NGRS03
1611 FIELD #6,48 AS NRE004,2 AS NEXE01,2 AS NEXS01,2 AS NEXE02,2 AS NEXS02,2 AS NEXE03,2 AS NEXS03
1612 FIELD #6,60 AS NRE005,2 AS NLIE01,2 AS NLIS01,2 AS NLIE02,2 AS NLIS02,2 AS NLIE03,2 AS NLIS03
1613 FIELD #6,72 AS NRE006,1 AS NCOMP1,1 AS NCOMP2,1 AS NCOMP3,1 AS NTARE1,1 AS NTARE2,1 AS NTARE3,22 AS NRE007
1614 '
1615 'RETURN
1616 '
1617 FOR A%=1 TO 9999
1618 GET #6,A%
1620 LSET NCOE11=MKI$(0):LSET NCOS11=MKI$(0):LSET NCOE12=MKI$(0):LSET NCOS12=MKI$(0):LSET NCOE13=MKI$(0):LSET NCOS13=MKI$(0)
1621 LSET NCOE21=MKI$(0):LSET NCOS21=MKI$(0):LSET NCOE22=MKI$(0):LSET NCOS22=MKI$(0):LSET NCOE23=MKI$(0):LSET NCOS23=MKI$(0)
1622 LSET NCOE31=MKI$(0):LSET NCOS31=MKI$(0):LSET NCOE32=MKI$(0):LSET NCOS32=MKI$(0):LSET NCOE33=MKI$(0):LSET NCOS33=MKI$(0)
1623 LSET NGRE01=MKI$(0):LSET NGRS01=MKI$(0):LSET NGRE02=MKI$(0):LSET NGRS02=MKI$(0):LSET NGRE03=MKI$(0):LSET NGRS03=MKI$(0)
1624 LSET NEXE01=MKI$(0):LSET NEXS01=MKI$(0):LSET NEXE02=MKI$(0):LSET NEXS02=MKI$(0):LSET NEXE03=MKI$(0):LSET NEXS03=MKI$(0)
1625 LSET NLIE01=MKI$(0):LSET NLIS01=MKI$(0):LSET NLIE02=MKI$(0):LSET NLIS02=MKI$(0):LSET NLIE03=MKI$(0):LSET NLIS03=MKI$(0)
1626 LSET NCOMP1="":LSET NCOMP2="":LSET NCOMP3=""
1627 LSET NTARE1="":LSET NTARE2="":LSET NTARE3=""
1628 LSET NRE007=""
1632 PUT #6,A%
1633 NEXT A%
1634 CLOSE
1636 GOTO 9000
8000 '***********************************************
8010 '***  RUTINA PARA SACAR CARATULA EN PANTALLA ***
8020 '***********************************************
8030 '
8040 CLS:LOCATE 1,1:PRINT CHR$(201)+STRING$(78,205)+CHR$(187)
8050 LOCATE 2,1:PRINT CHR$(186):COLOR 0,7,0:LOCATE 2,3:PRINT " CREAR FICHEROS":COLOR 7,0,0:LOCATE 2,26:PRINT "   Aplicacion : PUNTO DE VENTA":LOCATE 2,63:PRINT "FECHA : "FECHA$" ": LOCATE 2,80 :PRINT CHR$(186)
8060 LOCATE 3,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8070 FOR J%=4 TO 20 :LOCATE J%,1:PRINT CHR$(186):LOCATE J%,80 :PRINT CHR$(186):NEXT
8080 LOCATE 21,1:PRINT CHR$(204)+STRING$(78,205)+CHR$(185)
8090 LOCATE 22,1:PRINT CHR$(186):LOCATE 22,3:PRINT "  Mensajes: ":LOCATE 22,80:PRINT CHR$(186)
8100 LOCATE 23,1:PRINT CHR$(200)+STRING$(78,205)+CHR$(188);
8110 RETURN
8120 '
8250 '
8490 '*************************
8500 '***IMPRESION DE MENSAJES*
8510 '*************************
8515 '
8520 L.L$=""+MEN$+"":LOCATE 22,15:PRINT L.L$;
8525 IF RET%=1 THEN FOR KK%=1 TO 15000:NEXT KK%:RET%=0
8530 MEN$=SPACE$(64)
8540 RETURN
8550 '
9000 '**********************
9010 '***FIN DEL PROGRAMA***
9020 '**********************
9030 CLOSE
9040 RUN "PACAINIC"
9050 SYSTEM
9060 '
9070 '
9080 '
9090 '
9100 '*******************************
9110 '***RUTINA CONTROL DE ERRORES***
9120 '*******************************
9180 ON ERROR GOTO 0
63000 '********************************
63010 '***RUTINA DE ENTRADA NUMERICA***
63020 '********************************
63030 '
63040 D.E$="":I.T%=0
63050 LOCATE F.C1%,C.C1%,1,0,6
63060 FOR JMG%=1 TO L.E%
63070  D.R$=INPUT$(1)
63080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 63200  '===>AL NEXT
63090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 63200  '===>AL NEXT
63092  IF ASC(D.R$)=15 THEN JMG%=L.E%:I.T%=9:GOTO 63200  '===>AL NEXT
63100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 63200  '===>AL NEXT
63110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 63200   '===>AL NEXT
63120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 63200   '===>AL NEXT
63130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%,"-"):LOCATE F.C1%,C.C1%
63140  IF D.R$<"0" OR D.R$>"9" THEN 63170               'Error
63150  D.E$=D.E$+D.R$:PRINT D.R$;
63160  GOTO 63200 'AL NEXT
63170  'Error.
63175  IF ASC(D.R$)=8 AND JMG%=1 THEN 63190
63180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT "-":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
63190  JMG%=JMG%-1
63200 NEXT JMG%
63210 IF I.T%<>0 THEN 63230
63212 IF ESP%=1 AND LEN(D.E$)=2 THEN RETURN
63220 IF LEN(D.E$)<>L.E% THEN D.E$=LEFT$(CERO$,L.E%-LEN(D.E$))+D.E$
63225 IF ESC%=1 THEN LOCATE F.C1%,C.C1%:PRINT D.E$
63230 RETURN
63240 '
64000 '*************************************
64010 '***RUTINA DE ENTRADA ALFA/NUMERICA***
64020 '*************************************
64030 '
64040 D.E$="":I.T%=0
64050 LOCATE F.C1%,C.C1%,1,0,6
64060 FOR JMG%=1 TO L.E%
64070  D.R$=INPUT$(1)
64080  IF ASC(D.R$)=13 AND JMG%=1 THEN JMG%=L.E%:I.T%=1:GOTO 64200  '===>AL NEXT
64090  IF ASC(D.R$)=13 THEN JMG%=L.E%:GOTO 64200  '===>AL NEXT
64100  IF ASC(D.R$)=10 THEN JMG%=L.E%:I.T%=2:GOTO 64200  '===>AL NEXT
64110  IF ASC(D.R$)=9 THEN JMG%=L.E%:I.T%=3:GOTO 64200   '===>AL NEXT
64120  IF ASC(D.R$)=7 THEN JMG%=L.E%:I.T%=4:GOTO 64200   '===>AL NEXT
64130  IF JMG%=1 THEN LOCATE F.C1%,C.C1%:PRINT STRING$(BO%," "):LOCATE F.C1%,C.C1%
64135  IF ASC(D.R$)=34 THEN 64170
64140  IF ASC(D.R$)<32 OR ASC(D.R$)>126 THEN 64170               'Error
64150  D.E$=D.E$+D.R$:PRINT D.R$;
64160  GOTO 64200 'AL NEXT
64170  'Error.
64175  IF ASC(D.R$)=8 AND JMG%=1 THEN 64190
64180  IF ASC(D.R$)=8 THEN LOCATE F.C1%,C.C1%+LEN(D.E$)-1:PRINT " ":LOCATE F.C1%,C.C1%+LEN(D.E$)-1:D.E$=LEFT$(D.E$,LEN(D.E$)-1):JMG%=JMG%-1
64190  JMG%=JMG%-1
64200 NEXT JMG%
64210 IF I.T%<>0 THEN 64230
64220 'LOCATE F.C1%,C.C1%:PRINT SPC(L.E%)
64225 'LOCATE F.C1%,C.C1%:PRINT D.E$
64230 RETURN
64240 '
